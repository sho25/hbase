begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_comment
comment|/**  *  * Licensed to the Apache Software Foundation (ASF) under one  * or more contributor license agreements.  See the NOTICE file  * distributed with this work for additional information  * regarding copyright ownership.  The ASF licenses this file  * to you under the Apache License, Version 2.0 (the  * "License"); you may not use this file except in compliance  * with the License.  You may obtain a copy of the License at  *  *     http://www.apache.org/licenses/LICENSE-2.0  *  * Unless required by applicable law or agreed to in writing, software  * distributed under the License is distributed on an "AS IS" BASIS,  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  * See the License for the specific language governing permissions and  * limitations under the License.  */
end_comment

begin_package
package|package
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|master
package|;
end_package

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|net
operator|.
name|InetAddress
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|ArrayList
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Collection
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Iterator
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Map
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|regex
operator|.
name|Pattern
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|commons
operator|.
name|logging
operator|.
name|Log
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|commons
operator|.
name|logging
operator|.
name|LogFactory
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|HColumnDescriptor
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|HConstants
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|HRegionInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|HTableDescriptor
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|MetaTableAccessor
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|NamespaceDescriptor
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|PleaseHoldException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|ServerLoad
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|ServerName
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|TableName
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|TableNotFoundException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|UnknownRegionException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|classification
operator|.
name|InterfaceAudience
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|client
operator|.
name|TableState
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|exceptions
operator|.
name|MergeRegionException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|exceptions
operator|.
name|UnknownProtocolException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|ipc
operator|.
name|RpcServer
operator|.
name|BlockingServiceAndInterface
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|ipc
operator|.
name|ServerRpcController
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|procedure
operator|.
name|MasterProcedureManager
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|ProtobufUtil
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|RequestConverter
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|ResponseConverter
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|ClientProtos
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|ClusterStatusProtos
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|HBaseProtos
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|HBaseProtos
operator|.
name|NameStringPair
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|HBaseProtos
operator|.
name|ProcedureDescription
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|HBaseProtos
operator|.
name|RegionSpecifier
operator|.
name|RegionSpecifierType
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|HBaseProtos
operator|.
name|SnapshotDescription
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|AddColumnRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|AddColumnResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|AssignRegionRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|AssignRegionResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|BalanceRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|BalanceResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|CreateNamespaceRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|CreateNamespaceResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|CreateTableRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|CreateTableResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|DeleteColumnRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|DeleteColumnResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|DeleteNamespaceRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|DeleteNamespaceResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|DeleteSnapshotRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|DeleteSnapshotResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|DeleteTableRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|DeleteTableResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|DisableTableRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|DisableTableResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|DispatchMergingRegionsRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|DispatchMergingRegionsResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|EnableCatalogJanitorRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|EnableCatalogJanitorResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|EnableTableRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|EnableTableResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|ExecProcedureRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|ExecProcedureResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|GetClusterStatusRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|GetClusterStatusResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|GetCompletedSnapshotsRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|GetCompletedSnapshotsResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|GetNamespaceDescriptorRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|GetNamespaceDescriptorResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|GetSchemaAlterStatusRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|GetSchemaAlterStatusResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|GetTableDescriptorsRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|GetTableDescriptorsResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|GetTableNamesRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|GetTableNamesResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|IsCatalogJanitorEnabledRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|IsCatalogJanitorEnabledResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|IsMasterRunningRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|IsMasterRunningResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|IsProcedureDoneRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|IsProcedureDoneResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|IsRestoreSnapshotDoneRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|IsRestoreSnapshotDoneResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|IsSnapshotDoneRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|IsSnapshotDoneResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|ListNamespaceDescriptorsRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|ListNamespaceDescriptorsResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|ListTableDescriptorsByNamespaceRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|ListTableDescriptorsByNamespaceResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|ListTableNamesByNamespaceRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|ListTableNamesByNamespaceResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|MasterService
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|ModifyColumnRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|ModifyColumnResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|ModifyNamespaceRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|ModifyNamespaceResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|ModifyTableRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|ModifyTableResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|MoveRegionRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|MoveRegionResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|OfflineRegionRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|OfflineRegionResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|RestoreSnapshotRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|RestoreSnapshotResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|RunCatalogScanRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|RunCatalogScanResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|SetBalancerRunningRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|SetBalancerRunningResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|SetQuotaRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|SetQuotaResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|ShutdownRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|ShutdownResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|SnapshotRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|SnapshotResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|StopMasterRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|StopMasterResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|TruncateTableRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|TruncateTableResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|UnassignRegionRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|MasterProtos
operator|.
name|UnassignRegionResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|RegionServerStatusProtos
operator|.
name|GetLastFlushedSequenceIdRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|RegionServerStatusProtos
operator|.
name|GetLastFlushedSequenceIdResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|RegionServerStatusProtos
operator|.
name|RegionServerReportRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|RegionServerStatusProtos
operator|.
name|RegionServerReportResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|RegionServerStatusProtos
operator|.
name|RegionServerStartupRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|RegionServerStatusProtos
operator|.
name|RegionServerStartupResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|RegionServerStatusProtos
operator|.
name|RegionServerStatusService
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|RegionServerStatusProtos
operator|.
name|RegionStateTransition
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|RegionServerStatusProtos
operator|.
name|ReportRSFatalErrorRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|RegionServerStatusProtos
operator|.
name|ReportRSFatalErrorResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|RegionServerStatusProtos
operator|.
name|ReportRegionStateTransitionRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|protobuf
operator|.
name|generated
operator|.
name|RegionServerStatusProtos
operator|.
name|ReportRegionStateTransitionResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|regionserver
operator|.
name|RSRpcServices
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|snapshot
operator|.
name|ClientSnapshotDescriptionUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|snapshot
operator|.
name|SnapshotDescriptionUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|util
operator|.
name|Bytes
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|util
operator|.
name|Pair
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|zookeeper
operator|.
name|KeeperException
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|protobuf
operator|.
name|ByteString
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|protobuf
operator|.
name|Descriptors
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|protobuf
operator|.
name|Message
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|protobuf
operator|.
name|RpcCallback
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|protobuf
operator|.
name|RpcController
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|protobuf
operator|.
name|Service
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|protobuf
operator|.
name|ServiceException
import|;
end_import

begin_comment
comment|/**  * Implements the master RPC services.  */
end_comment

begin_class
annotation|@
name|InterfaceAudience
operator|.
name|Private
annotation|@
name|SuppressWarnings
argument_list|(
literal|"deprecation"
argument_list|)
specifier|public
class|class
name|MasterRpcServices
extends|extends
name|RSRpcServices
implements|implements
name|MasterService
operator|.
name|BlockingInterface
implements|,
name|RegionServerStatusService
operator|.
name|BlockingInterface
block|{
specifier|protected
specifier|static
specifier|final
name|Log
name|LOG
init|=
name|LogFactory
operator|.
name|getLog
argument_list|(
name|MasterRpcServices
operator|.
name|class
operator|.
name|getName
argument_list|()
argument_list|)
decl_stmt|;
specifier|private
specifier|final
name|HMaster
name|master
decl_stmt|;
comment|/**    * @return Subset of configuration to pass initializing regionservers: e.g.    * the filesystem to use and root directory to use.    */
specifier|private
name|RegionServerStartupResponse
operator|.
name|Builder
name|createConfigurationSubset
parameter_list|()
block|{
name|RegionServerStartupResponse
operator|.
name|Builder
name|resp
init|=
name|addConfig
argument_list|(
name|RegionServerStartupResponse
operator|.
name|newBuilder
argument_list|()
argument_list|,
name|HConstants
operator|.
name|HBASE_DIR
argument_list|)
decl_stmt|;
name|resp
operator|=
name|addConfig
argument_list|(
name|resp
argument_list|,
literal|"fs.defaultFS"
argument_list|)
expr_stmt|;
return|return
name|addConfig
argument_list|(
name|resp
argument_list|,
literal|"hbase.master.info.port"
argument_list|)
return|;
block|}
specifier|private
name|RegionServerStartupResponse
operator|.
name|Builder
name|addConfig
parameter_list|(
specifier|final
name|RegionServerStartupResponse
operator|.
name|Builder
name|resp
parameter_list|,
specifier|final
name|String
name|key
parameter_list|)
block|{
name|NameStringPair
operator|.
name|Builder
name|entry
init|=
name|NameStringPair
operator|.
name|newBuilder
argument_list|()
operator|.
name|setName
argument_list|(
name|key
argument_list|)
operator|.
name|setValue
argument_list|(
name|master
operator|.
name|getConfiguration
argument_list|()
operator|.
name|get
argument_list|(
name|key
argument_list|)
argument_list|)
decl_stmt|;
name|resp
operator|.
name|addMapEntries
argument_list|(
name|entry
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
return|return
name|resp
return|;
block|}
specifier|public
name|MasterRpcServices
parameter_list|(
name|HMaster
name|m
parameter_list|)
throws|throws
name|IOException
block|{
name|super
argument_list|(
name|m
argument_list|)
expr_stmt|;
name|master
operator|=
name|m
expr_stmt|;
block|}
enum|enum
name|BalanceSwitchMode
block|{
name|SYNC
block|,
name|ASYNC
block|}
comment|/**    * Assigns balancer switch according to BalanceSwitchMode    * @param b new balancer switch    * @param mode BalanceSwitchMode    * @return old balancer switch    */
name|boolean
name|switchBalancer
parameter_list|(
specifier|final
name|boolean
name|b
parameter_list|,
name|BalanceSwitchMode
name|mode
parameter_list|)
throws|throws
name|IOException
block|{
name|boolean
name|oldValue
init|=
name|master
operator|.
name|loadBalancerTracker
operator|.
name|isBalancerOn
argument_list|()
decl_stmt|;
name|boolean
name|newValue
init|=
name|b
decl_stmt|;
try|try
block|{
if|if
condition|(
name|master
operator|.
name|cpHost
operator|!=
literal|null
condition|)
block|{
name|newValue
operator|=
name|master
operator|.
name|cpHost
operator|.
name|preBalanceSwitch
argument_list|(
name|newValue
argument_list|)
expr_stmt|;
block|}
try|try
block|{
if|if
condition|(
name|mode
operator|==
name|BalanceSwitchMode
operator|.
name|SYNC
condition|)
block|{
synchronized|synchronized
init|(
name|master
operator|.
name|balancer
init|)
block|{
name|master
operator|.
name|loadBalancerTracker
operator|.
name|setBalancerOn
argument_list|(
name|newValue
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|master
operator|.
name|loadBalancerTracker
operator|.
name|setBalancerOn
argument_list|(
name|newValue
argument_list|)
expr_stmt|;
block|}
block|}
catch|catch
parameter_list|(
name|KeeperException
name|ke
parameter_list|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
name|ke
argument_list|)
throw|;
block|}
name|LOG
operator|.
name|info
argument_list|(
name|master
operator|.
name|getClientIdAuditPrefix
argument_list|()
operator|+
literal|" set balanceSwitch="
operator|+
name|newValue
argument_list|)
expr_stmt|;
if|if
condition|(
name|master
operator|.
name|cpHost
operator|!=
literal|null
condition|)
block|{
name|master
operator|.
name|cpHost
operator|.
name|postBalanceSwitch
argument_list|(
name|oldValue
argument_list|,
name|newValue
argument_list|)
expr_stmt|;
block|}
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
name|LOG
operator|.
name|warn
argument_list|(
literal|"Error flipping balance switch"
argument_list|,
name|ioe
argument_list|)
expr_stmt|;
block|}
return|return
name|oldValue
return|;
block|}
name|boolean
name|synchronousBalanceSwitch
parameter_list|(
specifier|final
name|boolean
name|b
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|switchBalancer
argument_list|(
name|b
argument_list|,
name|BalanceSwitchMode
operator|.
name|SYNC
argument_list|)
return|;
block|}
comment|/**    * @return list of blocking services and their security info classes that this server supports    */
specifier|protected
name|List
argument_list|<
name|BlockingServiceAndInterface
argument_list|>
name|getServices
parameter_list|()
block|{
name|List
argument_list|<
name|BlockingServiceAndInterface
argument_list|>
name|bssi
init|=
operator|new
name|ArrayList
argument_list|<
name|BlockingServiceAndInterface
argument_list|>
argument_list|(
literal|4
argument_list|)
decl_stmt|;
name|bssi
operator|.
name|add
argument_list|(
operator|new
name|BlockingServiceAndInterface
argument_list|(
name|MasterService
operator|.
name|newReflectiveBlockingService
argument_list|(
name|this
argument_list|)
argument_list|,
name|MasterService
operator|.
name|BlockingInterface
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
name|bssi
operator|.
name|add
argument_list|(
operator|new
name|BlockingServiceAndInterface
argument_list|(
name|RegionServerStatusService
operator|.
name|newReflectiveBlockingService
argument_list|(
name|this
argument_list|)
argument_list|,
name|RegionServerStatusService
operator|.
name|BlockingInterface
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
name|bssi
operator|.
name|addAll
argument_list|(
name|super
operator|.
name|getServices
argument_list|()
argument_list|)
expr_stmt|;
return|return
name|bssi
return|;
block|}
annotation|@
name|Override
specifier|public
name|GetLastFlushedSequenceIdResponse
name|getLastFlushedSequenceId
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|GetLastFlushedSequenceIdRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|checkServiceStarted
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
name|byte
index|[]
name|regionName
init|=
name|request
operator|.
name|getRegionName
argument_list|()
operator|.
name|toByteArray
argument_list|()
decl_stmt|;
name|long
name|seqId
init|=
name|master
operator|.
name|serverManager
operator|.
name|getLastFlushedSequenceId
argument_list|(
name|regionName
argument_list|)
decl_stmt|;
return|return
name|ResponseConverter
operator|.
name|buildGetLastFlushedSequenceIdResponse
argument_list|(
name|seqId
argument_list|)
return|;
block|}
annotation|@
name|Override
specifier|public
name|RegionServerReportResponse
name|regionServerReport
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|RegionServerReportRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|checkServiceStarted
argument_list|()
expr_stmt|;
name|ClusterStatusProtos
operator|.
name|ServerLoad
name|sl
init|=
name|request
operator|.
name|getLoad
argument_list|()
decl_stmt|;
name|ServerName
name|serverName
init|=
name|ProtobufUtil
operator|.
name|toServerName
argument_list|(
name|request
operator|.
name|getServer
argument_list|()
argument_list|)
decl_stmt|;
name|ServerLoad
name|oldLoad
init|=
name|master
operator|.
name|serverManager
operator|.
name|getLoad
argument_list|(
name|serverName
argument_list|)
decl_stmt|;
name|master
operator|.
name|serverManager
operator|.
name|regionServerReport
argument_list|(
name|serverName
argument_list|,
operator|new
name|ServerLoad
argument_list|(
name|sl
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|sl
operator|!=
literal|null
operator|&&
name|master
operator|.
name|metricsMaster
operator|!=
literal|null
condition|)
block|{
comment|// Up our metrics.
name|master
operator|.
name|metricsMaster
operator|.
name|incrementRequests
argument_list|(
name|sl
operator|.
name|getTotalNumberOfRequests
argument_list|()
operator|-
operator|(
name|oldLoad
operator|!=
literal|null
condition|?
name|oldLoad
operator|.
name|getTotalNumberOfRequests
argument_list|()
else|:
literal|0
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
return|return
name|RegionServerReportResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|build
argument_list|()
return|;
block|}
annotation|@
name|Override
specifier|public
name|RegionServerStartupResponse
name|regionServerStartup
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|RegionServerStartupRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
comment|// Register with server manager
try|try
block|{
name|master
operator|.
name|checkServiceStarted
argument_list|()
expr_stmt|;
name|InetAddress
name|ia
init|=
name|master
operator|.
name|getRemoteInetAddress
argument_list|(
name|request
operator|.
name|getPort
argument_list|()
argument_list|,
name|request
operator|.
name|getServerStartCode
argument_list|()
argument_list|)
decl_stmt|;
name|ServerName
name|rs
init|=
name|master
operator|.
name|serverManager
operator|.
name|regionServerStartup
argument_list|(
name|ia
argument_list|,
name|request
operator|.
name|getPort
argument_list|()
argument_list|,
name|request
operator|.
name|getServerStartCode
argument_list|()
argument_list|,
name|request
operator|.
name|getServerCurrentTime
argument_list|()
argument_list|)
decl_stmt|;
comment|// Send back some config info
name|RegionServerStartupResponse
operator|.
name|Builder
name|resp
init|=
name|createConfigurationSubset
argument_list|()
decl_stmt|;
name|NameStringPair
operator|.
name|Builder
name|entry
init|=
name|NameStringPair
operator|.
name|newBuilder
argument_list|()
operator|.
name|setName
argument_list|(
name|HConstants
operator|.
name|KEY_FOR_HOSTNAME_SEEN_BY_MASTER
argument_list|)
operator|.
name|setValue
argument_list|(
name|rs
operator|.
name|getHostname
argument_list|()
argument_list|)
decl_stmt|;
name|resp
operator|.
name|addMapEntries
argument_list|(
name|entry
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
return|return
name|resp
operator|.
name|build
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
specifier|public
name|ReportRSFatalErrorResponse
name|reportRSFatalError
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|ReportRSFatalErrorRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
name|String
name|errorText
init|=
name|request
operator|.
name|getErrorMessage
argument_list|()
decl_stmt|;
name|ServerName
name|sn
init|=
name|ProtobufUtil
operator|.
name|toServerName
argument_list|(
name|request
operator|.
name|getServer
argument_list|()
argument_list|)
decl_stmt|;
name|String
name|msg
init|=
literal|"Region server "
operator|+
name|sn
operator|+
literal|" reported a fatal error:\n"
operator|+
name|errorText
decl_stmt|;
name|LOG
operator|.
name|error
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|master
operator|.
name|rsFatals
operator|.
name|add
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
name|ReportRSFatalErrorResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|build
argument_list|()
return|;
block|}
annotation|@
name|Override
specifier|public
name|AddColumnResponse
name|addColumn
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|AddColumnRequest
name|req
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|addColumn
argument_list|(
name|ProtobufUtil
operator|.
name|toTableName
argument_list|(
name|req
operator|.
name|getTableName
argument_list|()
argument_list|)
argument_list|,
name|HColumnDescriptor
operator|.
name|convert
argument_list|(
name|req
operator|.
name|getColumnFamilies
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
return|return
name|AddColumnResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|build
argument_list|()
return|;
block|}
annotation|@
name|Override
specifier|public
name|AssignRegionResponse
name|assignRegion
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|AssignRegionRequest
name|req
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
specifier|final
name|byte
index|[]
name|regionName
init|=
name|req
operator|.
name|getRegion
argument_list|()
operator|.
name|getValue
argument_list|()
operator|.
name|toByteArray
argument_list|()
decl_stmt|;
name|RegionSpecifierType
name|type
init|=
name|req
operator|.
name|getRegion
argument_list|()
operator|.
name|getType
argument_list|()
decl_stmt|;
name|AssignRegionResponse
name|arr
init|=
name|AssignRegionResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|build
argument_list|()
decl_stmt|;
name|master
operator|.
name|checkInitialized
argument_list|()
expr_stmt|;
if|if
condition|(
name|type
operator|!=
name|RegionSpecifierType
operator|.
name|REGION_NAME
condition|)
block|{
name|LOG
operator|.
name|warn
argument_list|(
literal|"assignRegion specifier type: expected: "
operator|+
name|RegionSpecifierType
operator|.
name|REGION_NAME
operator|+
literal|" actual: "
operator|+
name|type
argument_list|)
expr_stmt|;
block|}
name|RegionStates
name|regionStates
init|=
name|master
operator|.
name|assignmentManager
operator|.
name|getRegionStates
argument_list|()
decl_stmt|;
name|HRegionInfo
name|regionInfo
init|=
name|regionStates
operator|.
name|getRegionInfo
argument_list|(
name|regionName
argument_list|)
decl_stmt|;
if|if
condition|(
name|regionInfo
operator|==
literal|null
condition|)
throw|throw
operator|new
name|UnknownRegionException
argument_list|(
name|Bytes
operator|.
name|toString
argument_list|(
name|regionName
argument_list|)
argument_list|)
throw|;
if|if
condition|(
name|master
operator|.
name|cpHost
operator|!=
literal|null
condition|)
block|{
if|if
condition|(
name|master
operator|.
name|cpHost
operator|.
name|preAssign
argument_list|(
name|regionInfo
argument_list|)
condition|)
block|{
return|return
name|arr
return|;
block|}
block|}
name|LOG
operator|.
name|info
argument_list|(
name|master
operator|.
name|getClientIdAuditPrefix
argument_list|()
operator|+
literal|" assign "
operator|+
name|regionInfo
operator|.
name|getRegionNameAsString
argument_list|()
argument_list|)
expr_stmt|;
name|master
operator|.
name|assignmentManager
operator|.
name|assign
argument_list|(
name|regionInfo
argument_list|,
literal|true
argument_list|)
expr_stmt|;
if|if
condition|(
name|master
operator|.
name|cpHost
operator|!=
literal|null
condition|)
block|{
name|master
operator|.
name|cpHost
operator|.
name|postAssign
argument_list|(
name|regionInfo
argument_list|)
expr_stmt|;
block|}
return|return
name|arr
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
specifier|public
name|BalanceResponse
name|balance
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|BalanceRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
return|return
name|BalanceResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|setBalancerRan
argument_list|(
name|master
operator|.
name|balance
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ex
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ex
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
specifier|public
name|CreateNamespaceResponse
name|createNamespace
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|CreateNamespaceRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|createNamespace
argument_list|(
name|ProtobufUtil
operator|.
name|toNamespaceDescriptor
argument_list|(
name|request
operator|.
name|getNamespaceDescriptor
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|CreateNamespaceResponse
operator|.
name|getDefaultInstance
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|e
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
specifier|public
name|CreateTableResponse
name|createTable
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|CreateTableRequest
name|req
parameter_list|)
throws|throws
name|ServiceException
block|{
name|HTableDescriptor
name|hTableDescriptor
init|=
name|HTableDescriptor
operator|.
name|convert
argument_list|(
name|req
operator|.
name|getTableSchema
argument_list|()
argument_list|)
decl_stmt|;
name|byte
index|[]
index|[]
name|splitKeys
init|=
name|ProtobufUtil
operator|.
name|getSplitKeysArray
argument_list|(
name|req
argument_list|)
decl_stmt|;
try|try
block|{
name|master
operator|.
name|createTable
argument_list|(
name|hTableDescriptor
argument_list|,
name|splitKeys
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
return|return
name|CreateTableResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|build
argument_list|()
return|;
block|}
annotation|@
name|Override
specifier|public
name|DeleteColumnResponse
name|deleteColumn
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|DeleteColumnRequest
name|req
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|deleteColumn
argument_list|(
name|ProtobufUtil
operator|.
name|toTableName
argument_list|(
name|req
operator|.
name|getTableName
argument_list|()
argument_list|)
argument_list|,
name|req
operator|.
name|getColumnName
argument_list|()
operator|.
name|toByteArray
argument_list|()
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
return|return
name|DeleteColumnResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|build
argument_list|()
return|;
block|}
annotation|@
name|Override
specifier|public
name|DeleteNamespaceResponse
name|deleteNamespace
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|DeleteNamespaceRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|deleteNamespace
argument_list|(
name|request
operator|.
name|getNamespaceName
argument_list|()
argument_list|)
expr_stmt|;
return|return
name|DeleteNamespaceResponse
operator|.
name|getDefaultInstance
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|e
argument_list|)
throw|;
block|}
block|}
comment|/**    * Execute Delete Snapshot operation.    * @return DeleteSnapshotResponse (a protobuf wrapped void) if the snapshot existed and was    *    deleted properly.    * @throws ServiceException wrapping SnapshotDoesNotExistException if specified snapshot did not    *    exist.    */
annotation|@
name|Override
specifier|public
name|DeleteSnapshotResponse
name|deleteSnapshot
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|DeleteSnapshotRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|checkInitialized
argument_list|()
expr_stmt|;
name|master
operator|.
name|snapshotManager
operator|.
name|checkSnapshotSupport
argument_list|()
expr_stmt|;
name|LOG
operator|.
name|info
argument_list|(
name|master
operator|.
name|getClientIdAuditPrefix
argument_list|()
operator|+
literal|" delete "
operator|+
name|request
operator|.
name|getSnapshot
argument_list|()
argument_list|)
expr_stmt|;
name|master
operator|.
name|snapshotManager
operator|.
name|deleteSnapshot
argument_list|(
name|request
operator|.
name|getSnapshot
argument_list|()
argument_list|)
expr_stmt|;
return|return
name|DeleteSnapshotResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|build
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|e
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
specifier|public
name|DeleteTableResponse
name|deleteTable
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|DeleteTableRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|deleteTable
argument_list|(
name|ProtobufUtil
operator|.
name|toTableName
argument_list|(
name|request
operator|.
name|getTableName
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
return|return
name|DeleteTableResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|build
argument_list|()
return|;
block|}
annotation|@
name|Override
specifier|public
name|TruncateTableResponse
name|truncateTable
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|TruncateTableRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|truncateTable
argument_list|(
name|ProtobufUtil
operator|.
name|toTableName
argument_list|(
name|request
operator|.
name|getTableName
argument_list|()
argument_list|)
argument_list|,
name|request
operator|.
name|getPreserveSplits
argument_list|()
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
return|return
name|TruncateTableResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|build
argument_list|()
return|;
block|}
annotation|@
name|Override
specifier|public
name|DisableTableResponse
name|disableTable
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|DisableTableRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|disableTable
argument_list|(
name|ProtobufUtil
operator|.
name|toTableName
argument_list|(
name|request
operator|.
name|getTableName
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
return|return
name|DisableTableResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|build
argument_list|()
return|;
block|}
annotation|@
name|Override
specifier|public
name|DispatchMergingRegionsResponse
name|dispatchMergingRegions
parameter_list|(
name|RpcController
name|c
parameter_list|,
name|DispatchMergingRegionsRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|checkInitialized
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
specifier|final
name|byte
index|[]
name|encodedNameOfRegionA
init|=
name|request
operator|.
name|getRegionA
argument_list|()
operator|.
name|getValue
argument_list|()
operator|.
name|toByteArray
argument_list|()
decl_stmt|;
specifier|final
name|byte
index|[]
name|encodedNameOfRegionB
init|=
name|request
operator|.
name|getRegionB
argument_list|()
operator|.
name|getValue
argument_list|()
operator|.
name|toByteArray
argument_list|()
decl_stmt|;
specifier|final
name|boolean
name|forcible
init|=
name|request
operator|.
name|getForcible
argument_list|()
decl_stmt|;
if|if
condition|(
name|request
operator|.
name|getRegionA
argument_list|()
operator|.
name|getType
argument_list|()
operator|!=
name|RegionSpecifierType
operator|.
name|ENCODED_REGION_NAME
operator|||
name|request
operator|.
name|getRegionB
argument_list|()
operator|.
name|getType
argument_list|()
operator|!=
name|RegionSpecifierType
operator|.
name|ENCODED_REGION_NAME
condition|)
block|{
name|LOG
operator|.
name|warn
argument_list|(
literal|"mergeRegions specifier type: expected: "
operator|+
name|RegionSpecifierType
operator|.
name|ENCODED_REGION_NAME
operator|+
literal|" actual: region_a="
operator|+
name|request
operator|.
name|getRegionA
argument_list|()
operator|.
name|getType
argument_list|()
operator|+
literal|", region_b="
operator|+
name|request
operator|.
name|getRegionB
argument_list|()
operator|.
name|getType
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|RegionStates
name|regionStates
init|=
name|master
operator|.
name|assignmentManager
operator|.
name|getRegionStates
argument_list|()
decl_stmt|;
name|RegionState
name|regionStateA
init|=
name|regionStates
operator|.
name|getRegionState
argument_list|(
name|Bytes
operator|.
name|toString
argument_list|(
name|encodedNameOfRegionA
argument_list|)
argument_list|)
decl_stmt|;
name|RegionState
name|regionStateB
init|=
name|regionStates
operator|.
name|getRegionState
argument_list|(
name|Bytes
operator|.
name|toString
argument_list|(
name|encodedNameOfRegionB
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|regionStateA
operator|==
literal|null
operator|||
name|regionStateB
operator|==
literal|null
condition|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
operator|new
name|UnknownRegionException
argument_list|(
name|Bytes
operator|.
name|toStringBinary
argument_list|(
name|regionStateA
operator|==
literal|null
condition|?
name|encodedNameOfRegionA
else|:
name|encodedNameOfRegionB
argument_list|)
argument_list|)
argument_list|)
throw|;
block|}
if|if
condition|(
operator|!
name|regionStateA
operator|.
name|isOpened
argument_list|()
operator|||
operator|!
name|regionStateB
operator|.
name|isOpened
argument_list|()
condition|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
operator|new
name|MergeRegionException
argument_list|(
literal|"Unable to merge regions not online "
operator|+
name|regionStateA
operator|+
literal|", "
operator|+
name|regionStateB
argument_list|)
argument_list|)
throw|;
block|}
name|HRegionInfo
name|regionInfoA
init|=
name|regionStateA
operator|.
name|getRegion
argument_list|()
decl_stmt|;
name|HRegionInfo
name|regionInfoB
init|=
name|regionStateB
operator|.
name|getRegion
argument_list|()
decl_stmt|;
if|if
condition|(
name|regionInfoA
operator|.
name|getReplicaId
argument_list|()
operator|!=
name|HRegionInfo
operator|.
name|DEFAULT_REPLICA_ID
operator|||
name|regionInfoB
operator|.
name|getReplicaId
argument_list|()
operator|!=
name|HRegionInfo
operator|.
name|DEFAULT_REPLICA_ID
condition|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
operator|new
name|MergeRegionException
argument_list|(
literal|"Can't merge non-default replicas"
argument_list|)
argument_list|)
throw|;
block|}
if|if
condition|(
name|regionInfoA
operator|.
name|compareTo
argument_list|(
name|regionInfoB
argument_list|)
operator|==
literal|0
condition|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
operator|new
name|MergeRegionException
argument_list|(
literal|"Unable to merge a region to itself "
operator|+
name|regionInfoA
operator|+
literal|", "
operator|+
name|regionInfoB
argument_list|)
argument_list|)
throw|;
block|}
if|if
condition|(
operator|!
name|forcible
operator|&&
operator|!
name|HRegionInfo
operator|.
name|areAdjacent
argument_list|(
name|regionInfoA
argument_list|,
name|regionInfoB
argument_list|)
condition|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
operator|new
name|MergeRegionException
argument_list|(
literal|"Unable to merge not adjacent regions "
operator|+
name|regionInfoA
operator|.
name|getRegionNameAsString
argument_list|()
operator|+
literal|", "
operator|+
name|regionInfoB
operator|.
name|getRegionNameAsString
argument_list|()
operator|+
literal|" where forcible = "
operator|+
name|forcible
argument_list|)
argument_list|)
throw|;
block|}
try|try
block|{
name|master
operator|.
name|dispatchMergingRegions
argument_list|(
name|regionInfoA
argument_list|,
name|regionInfoB
argument_list|,
name|forcible
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
return|return
name|DispatchMergingRegionsResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|build
argument_list|()
return|;
block|}
annotation|@
name|Override
specifier|public
name|EnableCatalogJanitorResponse
name|enableCatalogJanitor
parameter_list|(
name|RpcController
name|c
parameter_list|,
name|EnableCatalogJanitorRequest
name|req
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|checkInitialized
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
return|return
name|EnableCatalogJanitorResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|setPrevValue
argument_list|(
name|master
operator|.
name|catalogJanitorChore
operator|.
name|setEnabled
argument_list|(
name|req
operator|.
name|getEnable
argument_list|()
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
return|;
block|}
annotation|@
name|Override
specifier|public
name|EnableTableResponse
name|enableTable
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|EnableTableRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|enableTable
argument_list|(
name|ProtobufUtil
operator|.
name|toTableName
argument_list|(
name|request
operator|.
name|getTableName
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
return|return
name|EnableTableResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|build
argument_list|()
return|;
block|}
annotation|@
name|Override
specifier|public
name|ClientProtos
operator|.
name|CoprocessorServiceResponse
name|execMasterService
parameter_list|(
specifier|final
name|RpcController
name|controller
parameter_list|,
specifier|final
name|ClientProtos
operator|.
name|CoprocessorServiceRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|checkInitialized
argument_list|()
expr_stmt|;
name|ServerRpcController
name|execController
init|=
operator|new
name|ServerRpcController
argument_list|()
decl_stmt|;
name|ClientProtos
operator|.
name|CoprocessorServiceCall
name|call
init|=
name|request
operator|.
name|getCall
argument_list|()
decl_stmt|;
name|String
name|serviceName
init|=
name|call
operator|.
name|getServiceName
argument_list|()
decl_stmt|;
name|String
name|methodName
init|=
name|call
operator|.
name|getMethodName
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
name|master
operator|.
name|coprocessorServiceHandlers
operator|.
name|containsKey
argument_list|(
name|serviceName
argument_list|)
condition|)
block|{
throw|throw
operator|new
name|UnknownProtocolException
argument_list|(
literal|null
argument_list|,
literal|"No registered master coprocessor service found for name "
operator|+
name|serviceName
argument_list|)
throw|;
block|}
name|Service
name|service
init|=
name|master
operator|.
name|coprocessorServiceHandlers
operator|.
name|get
argument_list|(
name|serviceName
argument_list|)
decl_stmt|;
name|Descriptors
operator|.
name|ServiceDescriptor
name|serviceDesc
init|=
name|service
operator|.
name|getDescriptorForType
argument_list|()
decl_stmt|;
name|Descriptors
operator|.
name|MethodDescriptor
name|methodDesc
init|=
name|serviceDesc
operator|.
name|findMethodByName
argument_list|(
name|methodName
argument_list|)
decl_stmt|;
if|if
condition|(
name|methodDesc
operator|==
literal|null
condition|)
block|{
throw|throw
operator|new
name|UnknownProtocolException
argument_list|(
name|service
operator|.
name|getClass
argument_list|()
argument_list|,
literal|"Unknown method "
operator|+
name|methodName
operator|+
literal|" called on master service "
operator|+
name|serviceName
argument_list|)
throw|;
block|}
comment|//invoke the method
name|Message
name|execRequest
init|=
name|service
operator|.
name|getRequestPrototype
argument_list|(
name|methodDesc
argument_list|)
operator|.
name|newBuilderForType
argument_list|()
operator|.
name|mergeFrom
argument_list|(
name|call
operator|.
name|getRequest
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
specifier|final
name|Message
operator|.
name|Builder
name|responseBuilder
init|=
name|service
operator|.
name|getResponsePrototype
argument_list|(
name|methodDesc
argument_list|)
operator|.
name|newBuilderForType
argument_list|()
decl_stmt|;
name|service
operator|.
name|callMethod
argument_list|(
name|methodDesc
argument_list|,
name|execController
argument_list|,
name|execRequest
argument_list|,
operator|new
name|RpcCallback
argument_list|<
name|Message
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|run
parameter_list|(
name|Message
name|message
parameter_list|)
block|{
if|if
condition|(
name|message
operator|!=
literal|null
condition|)
block|{
name|responseBuilder
operator|.
name|mergeFrom
argument_list|(
name|message
argument_list|)
expr_stmt|;
block|}
block|}
block|}
argument_list|)
expr_stmt|;
name|Message
name|execResult
init|=
name|responseBuilder
operator|.
name|build
argument_list|()
decl_stmt|;
if|if
condition|(
name|execController
operator|.
name|getFailedOn
argument_list|()
operator|!=
literal|null
condition|)
block|{
throw|throw
name|execController
operator|.
name|getFailedOn
argument_list|()
throw|;
block|}
name|ClientProtos
operator|.
name|CoprocessorServiceResponse
operator|.
name|Builder
name|builder
init|=
name|ClientProtos
operator|.
name|CoprocessorServiceResponse
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|setRegion
argument_list|(
name|RequestConverter
operator|.
name|buildRegionSpecifier
argument_list|(
name|RegionSpecifierType
operator|.
name|REGION_NAME
argument_list|,
name|HConstants
operator|.
name|EMPTY_BYTE_ARRAY
argument_list|)
argument_list|)
expr_stmt|;
name|builder
operator|.
name|setValue
argument_list|(
name|builder
operator|.
name|getValueBuilder
argument_list|()
operator|.
name|setName
argument_list|(
name|execResult
operator|.
name|getClass
argument_list|()
operator|.
name|getName
argument_list|()
argument_list|)
operator|.
name|setValue
argument_list|(
name|execResult
operator|.
name|toByteString
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|build
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ie
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ie
argument_list|)
throw|;
block|}
block|}
comment|/**    * Triggers an asynchronous attempt to run a distributed procedure.    * {@inheritDoc}    */
annotation|@
name|Override
specifier|public
name|ExecProcedureResponse
name|execProcedure
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|ExecProcedureRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|checkInitialized
argument_list|()
expr_stmt|;
name|ProcedureDescription
name|desc
init|=
name|request
operator|.
name|getProcedure
argument_list|()
decl_stmt|;
name|MasterProcedureManager
name|mpm
init|=
name|master
operator|.
name|mpmHost
operator|.
name|getProcedureManager
argument_list|(
name|desc
operator|.
name|getSignature
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|mpm
operator|==
literal|null
condition|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
literal|"The procedure is not registered: "
operator|+
name|desc
operator|.
name|getSignature
argument_list|()
argument_list|)
throw|;
block|}
name|LOG
operator|.
name|info
argument_list|(
name|master
operator|.
name|getClientIdAuditPrefix
argument_list|()
operator|+
literal|" procedure request for: "
operator|+
name|desc
operator|.
name|getSignature
argument_list|()
argument_list|)
expr_stmt|;
name|mpm
operator|.
name|execProcedure
argument_list|(
name|desc
argument_list|)
expr_stmt|;
comment|// send back the max amount of time the client should wait for the procedure
comment|// to complete
name|long
name|waitTime
init|=
name|SnapshotDescriptionUtils
operator|.
name|DEFAULT_MAX_WAIT_TIME
decl_stmt|;
return|return
name|ExecProcedureResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|setExpectedTimeout
argument_list|(
name|waitTime
argument_list|)
operator|.
name|build
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|e
argument_list|)
throw|;
block|}
block|}
comment|/**    * Triggers a synchronous attempt to run a distributed procedure and sets    * return data in response.    * {@inheritDoc}    */
annotation|@
name|Override
specifier|public
name|ExecProcedureResponse
name|execProcedureWithRet
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|ExecProcedureRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|checkInitialized
argument_list|()
expr_stmt|;
name|ProcedureDescription
name|desc
init|=
name|request
operator|.
name|getProcedure
argument_list|()
decl_stmt|;
name|MasterProcedureManager
name|mpm
init|=
name|master
operator|.
name|mpmHost
operator|.
name|getProcedureManager
argument_list|(
name|desc
operator|.
name|getSignature
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|mpm
operator|==
literal|null
condition|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
literal|"The procedure is not registered: "
operator|+
name|desc
operator|.
name|getSignature
argument_list|()
argument_list|)
throw|;
block|}
name|LOG
operator|.
name|info
argument_list|(
name|master
operator|.
name|getClientIdAuditPrefix
argument_list|()
operator|+
literal|" procedure request for: "
operator|+
name|desc
operator|.
name|getSignature
argument_list|()
argument_list|)
expr_stmt|;
name|byte
index|[]
name|data
init|=
name|mpm
operator|.
name|execProcedureWithRet
argument_list|(
name|desc
argument_list|)
decl_stmt|;
name|ExecProcedureResponse
operator|.
name|Builder
name|builder
init|=
name|ExecProcedureResponse
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
comment|// set return data if available
if|if
condition|(
name|data
operator|!=
literal|null
condition|)
block|{
name|builder
operator|.
name|setReturnData
argument_list|(
name|ByteString
operator|.
name|copyFrom
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|builder
operator|.
name|build
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|e
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
specifier|public
name|GetClusterStatusResponse
name|getClusterStatus
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|GetClusterStatusRequest
name|req
parameter_list|)
throws|throws
name|ServiceException
block|{
name|GetClusterStatusResponse
operator|.
name|Builder
name|response
init|=
name|GetClusterStatusResponse
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
try|try
block|{
name|master
operator|.
name|checkInitialized
argument_list|()
expr_stmt|;
name|response
operator|.
name|setClusterStatus
argument_list|(
name|master
operator|.
name|getClusterStatus
argument_list|()
operator|.
name|convert
argument_list|()
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|e
argument_list|)
throw|;
block|}
return|return
name|response
operator|.
name|build
argument_list|()
return|;
block|}
comment|/**    * List the currently available/stored snapshots. Any in-progress snapshots are ignored    */
annotation|@
name|Override
specifier|public
name|GetCompletedSnapshotsResponse
name|getCompletedSnapshots
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|GetCompletedSnapshotsRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|checkInitialized
argument_list|()
expr_stmt|;
name|GetCompletedSnapshotsResponse
operator|.
name|Builder
name|builder
init|=
name|GetCompletedSnapshotsResponse
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|List
argument_list|<
name|SnapshotDescription
argument_list|>
name|snapshots
init|=
name|master
operator|.
name|snapshotManager
operator|.
name|getCompletedSnapshots
argument_list|()
decl_stmt|;
comment|// convert to protobuf
for|for
control|(
name|SnapshotDescription
name|snapshot
range|:
name|snapshots
control|)
block|{
name|builder
operator|.
name|addSnapshots
argument_list|(
name|snapshot
argument_list|)
expr_stmt|;
block|}
return|return
name|builder
operator|.
name|build
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|e
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
specifier|public
name|GetNamespaceDescriptorResponse
name|getNamespaceDescriptor
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|GetNamespaceDescriptorRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
return|return
name|GetNamespaceDescriptorResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|setNamespaceDescriptor
argument_list|(
name|ProtobufUtil
operator|.
name|toProtoNamespaceDescriptor
argument_list|(
name|master
operator|.
name|getNamespaceDescriptor
argument_list|(
name|request
operator|.
name|getNamespaceName
argument_list|()
argument_list|)
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|e
argument_list|)
throw|;
block|}
block|}
comment|/**    * Get the number of regions of the table that have been updated by the alter.    *    * @return Pair indicating the number of regions updated Pair.getFirst is the    *         regions that are yet to be updated Pair.getSecond is the total number    *         of regions of the table    * @throws IOException    */
annotation|@
name|Override
specifier|public
name|GetSchemaAlterStatusResponse
name|getSchemaAlterStatus
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|GetSchemaAlterStatusRequest
name|req
parameter_list|)
throws|throws
name|ServiceException
block|{
comment|// TODO: currently, we query using the table name on the client side. this
comment|// may overlap with other table operations or the table operation may
comment|// have completed before querying this API. We need to refactor to a
comment|// transaction system in the future to avoid these ambiguities.
name|TableName
name|tableName
init|=
name|ProtobufUtil
operator|.
name|toTableName
argument_list|(
name|req
operator|.
name|getTableName
argument_list|()
argument_list|)
decl_stmt|;
try|try
block|{
name|master
operator|.
name|checkInitialized
argument_list|()
expr_stmt|;
name|Pair
argument_list|<
name|Integer
argument_list|,
name|Integer
argument_list|>
name|pair
init|=
name|master
operator|.
name|assignmentManager
operator|.
name|getReopenStatus
argument_list|(
name|tableName
argument_list|)
decl_stmt|;
name|GetSchemaAlterStatusResponse
operator|.
name|Builder
name|ret
init|=
name|GetSchemaAlterStatusResponse
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|ret
operator|.
name|setYetToUpdateRegions
argument_list|(
name|pair
operator|.
name|getFirst
argument_list|()
argument_list|)
expr_stmt|;
name|ret
operator|.
name|setTotalRegions
argument_list|(
name|pair
operator|.
name|getSecond
argument_list|()
argument_list|)
expr_stmt|;
return|return
name|ret
operator|.
name|build
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
block|}
comment|/**    * Get list of TableDescriptors for requested tables.    * @param c Unused (set to null).    * @param req GetTableDescriptorsRequest that contains:    * - tableNames: requested tables, or if empty, all are requested    * @return GetTableDescriptorsResponse    * @throws ServiceException    */
annotation|@
name|Override
specifier|public
name|GetTableDescriptorsResponse
name|getTableDescriptors
parameter_list|(
name|RpcController
name|c
parameter_list|,
name|GetTableDescriptorsRequest
name|req
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|checkInitialized
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|e
argument_list|)
throw|;
block|}
name|List
argument_list|<
name|HTableDescriptor
argument_list|>
name|descriptors
init|=
operator|new
name|ArrayList
argument_list|<
name|HTableDescriptor
argument_list|>
argument_list|()
decl_stmt|;
name|List
argument_list|<
name|TableName
argument_list|>
name|tableNameList
init|=
operator|new
name|ArrayList
argument_list|<
name|TableName
argument_list|>
argument_list|()
decl_stmt|;
for|for
control|(
name|HBaseProtos
operator|.
name|TableName
name|tableNamePB
range|:
name|req
operator|.
name|getTableNamesList
argument_list|()
control|)
block|{
name|tableNameList
operator|.
name|add
argument_list|(
name|ProtobufUtil
operator|.
name|toTableName
argument_list|(
name|tableNamePB
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|boolean
name|bypass
init|=
literal|false
decl_stmt|;
name|String
name|regex
init|=
name|req
operator|.
name|hasRegex
argument_list|()
condition|?
name|req
operator|.
name|getRegex
argument_list|()
else|:
literal|null
decl_stmt|;
if|if
condition|(
name|master
operator|.
name|cpHost
operator|!=
literal|null
condition|)
block|{
try|try
block|{
name|bypass
operator|=
name|master
operator|.
name|cpHost
operator|.
name|preGetTableDescriptors
argument_list|(
name|tableNameList
argument_list|,
name|descriptors
argument_list|)
expr_stmt|;
comment|// method required for AccessController.
name|bypass
operator||=
name|master
operator|.
name|cpHost
operator|.
name|preGetTableDescriptors
argument_list|(
name|tableNameList
argument_list|,
name|descriptors
argument_list|,
name|regex
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
block|}
if|if
condition|(
operator|!
name|bypass
condition|)
block|{
if|if
condition|(
name|req
operator|.
name|getTableNamesCount
argument_list|()
operator|==
literal|0
condition|)
block|{
comment|// request for all TableDescriptors
name|Map
argument_list|<
name|String
argument_list|,
name|HTableDescriptor
argument_list|>
name|descriptorMap
init|=
literal|null
decl_stmt|;
try|try
block|{
name|descriptorMap
operator|=
name|master
operator|.
name|getTableDescriptors
argument_list|()
operator|.
name|getAll
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
name|LOG
operator|.
name|warn
argument_list|(
literal|"Failed getting all descriptors"
argument_list|,
name|e
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|descriptorMap
operator|!=
literal|null
condition|)
block|{
for|for
control|(
name|HTableDescriptor
name|desc
range|:
name|descriptorMap
operator|.
name|values
argument_list|()
control|)
block|{
if|if
condition|(
operator|!
name|desc
operator|.
name|getTableName
argument_list|()
operator|.
name|isSystemTable
argument_list|()
condition|)
block|{
name|descriptors
operator|.
name|add
argument_list|(
name|desc
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
else|else
block|{
for|for
control|(
name|TableName
name|s
range|:
name|tableNameList
control|)
block|{
try|try
block|{
name|HTableDescriptor
name|desc
init|=
name|master
operator|.
name|getTableDescriptors
argument_list|()
operator|.
name|get
argument_list|(
name|s
argument_list|)
decl_stmt|;
if|if
condition|(
name|desc
operator|!=
literal|null
condition|)
block|{
name|descriptors
operator|.
name|add
argument_list|(
name|desc
argument_list|)
expr_stmt|;
block|}
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
name|LOG
operator|.
name|warn
argument_list|(
literal|"Failed getting descriptor for "
operator|+
name|s
argument_list|,
name|e
argument_list|)
expr_stmt|;
block|}
block|}
block|}
comment|// Retains only those matched by regular expression.
if|if
condition|(
name|regex
operator|!=
literal|null
condition|)
block|{
name|Pattern
name|pat
init|=
name|Pattern
operator|.
name|compile
argument_list|(
name|regex
argument_list|)
decl_stmt|;
for|for
control|(
name|Iterator
argument_list|<
name|HTableDescriptor
argument_list|>
name|itr
init|=
name|descriptors
operator|.
name|iterator
argument_list|()
init|;
name|itr
operator|.
name|hasNext
argument_list|()
condition|;
control|)
block|{
name|HTableDescriptor
name|htd
init|=
name|itr
operator|.
name|next
argument_list|()
decl_stmt|;
name|String
name|tableName
init|=
name|htd
operator|.
name|getTableName
argument_list|()
operator|.
name|getNameAsString
argument_list|()
decl_stmt|;
name|String
name|defaultNameSpace
init|=
name|NamespaceDescriptor
operator|.
name|DEFAULT_NAMESPACE_NAME_STR
decl_stmt|;
name|boolean
name|matched
init|=
name|pat
operator|.
name|matcher
argument_list|(
name|tableName
argument_list|)
operator|.
name|matches
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
name|matched
operator|&&
name|htd
operator|.
name|getTableName
argument_list|()
operator|.
name|getNamespaceAsString
argument_list|()
operator|.
name|equals
argument_list|(
name|defaultNameSpace
argument_list|)
condition|)
block|{
name|matched
operator|=
name|pat
operator|.
name|matcher
argument_list|(
name|defaultNameSpace
operator|+
name|TableName
operator|.
name|NAMESPACE_DELIM
operator|+
name|tableName
argument_list|)
operator|.
name|matches
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|matched
condition|)
name|itr
operator|.
name|remove
argument_list|()
expr_stmt|;
block|}
block|}
if|if
condition|(
name|master
operator|.
name|cpHost
operator|!=
literal|null
condition|)
block|{
try|try
block|{
name|master
operator|.
name|cpHost
operator|.
name|postGetTableDescriptors
argument_list|(
name|descriptors
argument_list|)
expr_stmt|;
comment|// method required for AccessController.
name|master
operator|.
name|cpHost
operator|.
name|postGetTableDescriptors
argument_list|(
name|descriptors
argument_list|,
name|regex
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
block|}
block|}
name|GetTableDescriptorsResponse
operator|.
name|Builder
name|builder
init|=
name|GetTableDescriptorsResponse
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
for|for
control|(
name|HTableDescriptor
name|htd
range|:
name|descriptors
control|)
block|{
name|builder
operator|.
name|addTableSchema
argument_list|(
name|htd
operator|.
name|convert
argument_list|()
argument_list|)
expr_stmt|;
block|}
return|return
name|builder
operator|.
name|build
argument_list|()
return|;
block|}
comment|/**    * Get list of userspace table names    * @param controller Unused (set to null).    * @param req GetTableNamesRequest    * @return GetTableNamesResponse    * @throws ServiceException    */
annotation|@
name|Override
specifier|public
name|GetTableNamesResponse
name|getTableNames
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|GetTableNamesRequest
name|req
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|checkServiceStarted
argument_list|()
expr_stmt|;
name|Collection
argument_list|<
name|HTableDescriptor
argument_list|>
name|descriptors
init|=
name|master
operator|.
name|getTableDescriptors
argument_list|()
operator|.
name|getAll
argument_list|()
operator|.
name|values
argument_list|()
decl_stmt|;
name|GetTableNamesResponse
operator|.
name|Builder
name|builder
init|=
name|GetTableNamesResponse
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
for|for
control|(
name|HTableDescriptor
name|descriptor
range|:
name|descriptors
control|)
block|{
if|if
condition|(
name|descriptor
operator|.
name|getTableName
argument_list|()
operator|.
name|isSystemTable
argument_list|()
condition|)
block|{
continue|continue;
block|}
name|builder
operator|.
name|addTableNames
argument_list|(
name|ProtobufUtil
operator|.
name|toProtoTableName
argument_list|(
name|descriptor
operator|.
name|getTableName
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|builder
operator|.
name|build
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|e
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
specifier|public
name|MasterProtos
operator|.
name|GetTableStateResponse
name|getTableState
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|MasterProtos
operator|.
name|GetTableStateRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|checkServiceStarted
argument_list|()
expr_stmt|;
name|TableName
name|tableName
init|=
name|ProtobufUtil
operator|.
name|toTableName
argument_list|(
name|request
operator|.
name|getTableName
argument_list|()
argument_list|)
decl_stmt|;
name|TableState
operator|.
name|State
name|state
init|=
name|master
operator|.
name|getTableStateManager
argument_list|()
operator|.
name|getTableState
argument_list|(
name|tableName
argument_list|)
decl_stmt|;
if|if
condition|(
name|state
operator|==
literal|null
condition|)
throw|throw
operator|new
name|TableNotFoundException
argument_list|(
name|tableName
argument_list|)
throw|;
name|MasterProtos
operator|.
name|GetTableStateResponse
operator|.
name|Builder
name|builder
init|=
name|MasterProtos
operator|.
name|GetTableStateResponse
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|setTableState
argument_list|(
operator|new
name|TableState
argument_list|(
name|tableName
argument_list|,
name|state
argument_list|)
operator|.
name|convert
argument_list|()
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|build
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|e
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
specifier|public
name|IsCatalogJanitorEnabledResponse
name|isCatalogJanitorEnabled
parameter_list|(
name|RpcController
name|c
parameter_list|,
name|IsCatalogJanitorEnabledRequest
name|req
parameter_list|)
throws|throws
name|ServiceException
block|{
return|return
name|IsCatalogJanitorEnabledResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|setValue
argument_list|(
name|master
operator|.
name|isCatalogJanitorEnabled
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
return|;
block|}
annotation|@
name|Override
specifier|public
name|IsMasterRunningResponse
name|isMasterRunning
parameter_list|(
name|RpcController
name|c
parameter_list|,
name|IsMasterRunningRequest
name|req
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|checkServiceStarted
argument_list|()
expr_stmt|;
return|return
name|IsMasterRunningResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|setIsMasterRunning
argument_list|(
operator|!
name|master
operator|.
name|isStopped
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|e
argument_list|)
throw|;
block|}
block|}
comment|/**    * Checks if the specified procedure is done.    * @return true if the procedure is done,    *   false if the procedure is in the process of completing    * @throws ServiceException if invalid procedure, or    *  a failed procedure with progress failure reason.    */
annotation|@
name|Override
specifier|public
name|IsProcedureDoneResponse
name|isProcedureDone
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|IsProcedureDoneRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|checkInitialized
argument_list|()
expr_stmt|;
name|ProcedureDescription
name|desc
init|=
name|request
operator|.
name|getProcedure
argument_list|()
decl_stmt|;
name|MasterProcedureManager
name|mpm
init|=
name|master
operator|.
name|mpmHost
operator|.
name|getProcedureManager
argument_list|(
name|desc
operator|.
name|getSignature
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|mpm
operator|==
literal|null
condition|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
literal|"The procedure is not registered: "
operator|+
name|desc
operator|.
name|getSignature
argument_list|()
argument_list|)
throw|;
block|}
name|LOG
operator|.
name|debug
argument_list|(
literal|"Checking to see if procedure from request:"
operator|+
name|desc
operator|.
name|getSignature
argument_list|()
operator|+
literal|" is done"
argument_list|)
expr_stmt|;
name|IsProcedureDoneResponse
operator|.
name|Builder
name|builder
init|=
name|IsProcedureDoneResponse
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|boolean
name|done
init|=
name|mpm
operator|.
name|isProcedureDone
argument_list|(
name|desc
argument_list|)
decl_stmt|;
name|builder
operator|.
name|setDone
argument_list|(
name|done
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|build
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|e
argument_list|)
throw|;
block|}
block|}
comment|/**    * Returns the status of the requested snapshot restore/clone operation.    * This method is not exposed to the user, it is just used internally by HBaseAdmin    * to verify if the restore is completed.    *    * No exceptions are thrown if the restore is not running, the result will be "done".    *    * @return done<tt>true</tt> if the restore/clone operation is completed.    * @throws ServiceException if the operation failed.    */
annotation|@
name|Override
specifier|public
name|IsRestoreSnapshotDoneResponse
name|isRestoreSnapshotDone
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|IsRestoreSnapshotDoneRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|checkInitialized
argument_list|()
expr_stmt|;
name|SnapshotDescription
name|snapshot
init|=
name|request
operator|.
name|getSnapshot
argument_list|()
decl_stmt|;
name|IsRestoreSnapshotDoneResponse
operator|.
name|Builder
name|builder
init|=
name|IsRestoreSnapshotDoneResponse
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|boolean
name|done
init|=
name|master
operator|.
name|snapshotManager
operator|.
name|isRestoreDone
argument_list|(
name|snapshot
argument_list|)
decl_stmt|;
name|builder
operator|.
name|setDone
argument_list|(
name|done
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|build
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|e
argument_list|)
throw|;
block|}
block|}
comment|/**    * Checks if the specified snapshot is done.    * @return true if the snapshot is in file system ready to use,    *   false if the snapshot is in the process of completing    * @throws ServiceException wrapping UnknownSnapshotException if invalid snapshot, or    *  a wrapped HBaseSnapshotException with progress failure reason.    */
annotation|@
name|Override
specifier|public
name|IsSnapshotDoneResponse
name|isSnapshotDone
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|IsSnapshotDoneRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
name|LOG
operator|.
name|debug
argument_list|(
literal|"Checking to see if snapshot from request:"
operator|+
name|ClientSnapshotDescriptionUtils
operator|.
name|toString
argument_list|(
name|request
operator|.
name|getSnapshot
argument_list|()
argument_list|)
operator|+
literal|" is done"
argument_list|)
expr_stmt|;
try|try
block|{
name|master
operator|.
name|checkInitialized
argument_list|()
expr_stmt|;
name|IsSnapshotDoneResponse
operator|.
name|Builder
name|builder
init|=
name|IsSnapshotDoneResponse
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|boolean
name|done
init|=
name|master
operator|.
name|snapshotManager
operator|.
name|isSnapshotDone
argument_list|(
name|request
operator|.
name|getSnapshot
argument_list|()
argument_list|)
decl_stmt|;
name|builder
operator|.
name|setDone
argument_list|(
name|done
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|build
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|e
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
specifier|public
name|ListNamespaceDescriptorsResponse
name|listNamespaceDescriptors
parameter_list|(
name|RpcController
name|c
parameter_list|,
name|ListNamespaceDescriptorsRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|ListNamespaceDescriptorsResponse
operator|.
name|Builder
name|response
init|=
name|ListNamespaceDescriptorsResponse
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
for|for
control|(
name|NamespaceDescriptor
name|ns
range|:
name|master
operator|.
name|listNamespaceDescriptors
argument_list|()
control|)
block|{
name|response
operator|.
name|addNamespaceDescriptor
argument_list|(
name|ProtobufUtil
operator|.
name|toProtoNamespaceDescriptor
argument_list|(
name|ns
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|response
operator|.
name|build
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|e
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
specifier|public
name|ListTableDescriptorsByNamespaceResponse
name|listTableDescriptorsByNamespace
parameter_list|(
name|RpcController
name|c
parameter_list|,
name|ListTableDescriptorsByNamespaceRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|ListTableDescriptorsByNamespaceResponse
operator|.
name|Builder
name|b
init|=
name|ListTableDescriptorsByNamespaceResponse
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
for|for
control|(
name|HTableDescriptor
name|htd
range|:
name|master
operator|.
name|listTableDescriptorsByNamespace
argument_list|(
name|request
operator|.
name|getNamespaceName
argument_list|()
argument_list|)
control|)
block|{
name|b
operator|.
name|addTableSchema
argument_list|(
name|htd
operator|.
name|convert
argument_list|()
argument_list|)
expr_stmt|;
block|}
return|return
name|b
operator|.
name|build
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|e
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
specifier|public
name|ListTableNamesByNamespaceResponse
name|listTableNamesByNamespace
parameter_list|(
name|RpcController
name|c
parameter_list|,
name|ListTableNamesByNamespaceRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|ListTableNamesByNamespaceResponse
operator|.
name|Builder
name|b
init|=
name|ListTableNamesByNamespaceResponse
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
for|for
control|(
name|TableName
name|tableName
range|:
name|master
operator|.
name|listTableNamesByNamespace
argument_list|(
name|request
operator|.
name|getNamespaceName
argument_list|()
argument_list|)
control|)
block|{
name|b
operator|.
name|addTableName
argument_list|(
name|ProtobufUtil
operator|.
name|toProtoTableName
argument_list|(
name|tableName
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|b
operator|.
name|build
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|e
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
specifier|public
name|ModifyColumnResponse
name|modifyColumn
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|ModifyColumnRequest
name|req
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|modifyColumn
argument_list|(
name|ProtobufUtil
operator|.
name|toTableName
argument_list|(
name|req
operator|.
name|getTableName
argument_list|()
argument_list|)
argument_list|,
name|HColumnDescriptor
operator|.
name|convert
argument_list|(
name|req
operator|.
name|getColumnFamilies
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
return|return
name|ModifyColumnResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|build
argument_list|()
return|;
block|}
annotation|@
name|Override
specifier|public
name|ModifyNamespaceResponse
name|modifyNamespace
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|ModifyNamespaceRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|modifyNamespace
argument_list|(
name|ProtobufUtil
operator|.
name|toNamespaceDescriptor
argument_list|(
name|request
operator|.
name|getNamespaceDescriptor
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|ModifyNamespaceResponse
operator|.
name|getDefaultInstance
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|e
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
specifier|public
name|ModifyTableResponse
name|modifyTable
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|ModifyTableRequest
name|req
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|modifyTable
argument_list|(
name|ProtobufUtil
operator|.
name|toTableName
argument_list|(
name|req
operator|.
name|getTableName
argument_list|()
argument_list|)
argument_list|,
name|HTableDescriptor
operator|.
name|convert
argument_list|(
name|req
operator|.
name|getTableSchema
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
return|return
name|ModifyTableResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|build
argument_list|()
return|;
block|}
annotation|@
name|Override
specifier|public
name|MoveRegionResponse
name|moveRegion
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|MoveRegionRequest
name|req
parameter_list|)
throws|throws
name|ServiceException
block|{
specifier|final
name|byte
index|[]
name|encodedRegionName
init|=
name|req
operator|.
name|getRegion
argument_list|()
operator|.
name|getValue
argument_list|()
operator|.
name|toByteArray
argument_list|()
decl_stmt|;
name|RegionSpecifierType
name|type
init|=
name|req
operator|.
name|getRegion
argument_list|()
operator|.
name|getType
argument_list|()
decl_stmt|;
specifier|final
name|byte
index|[]
name|destServerName
init|=
operator|(
name|req
operator|.
name|hasDestServerName
argument_list|()
operator|)
condition|?
name|Bytes
operator|.
name|toBytes
argument_list|(
name|ProtobufUtil
operator|.
name|toServerName
argument_list|(
name|req
operator|.
name|getDestServerName
argument_list|()
argument_list|)
operator|.
name|getServerName
argument_list|()
argument_list|)
else|:
literal|null
decl_stmt|;
name|MoveRegionResponse
name|mrr
init|=
name|MoveRegionResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|build
argument_list|()
decl_stmt|;
if|if
condition|(
name|type
operator|!=
name|RegionSpecifierType
operator|.
name|ENCODED_REGION_NAME
condition|)
block|{
name|LOG
operator|.
name|warn
argument_list|(
literal|"moveRegion specifier type: expected: "
operator|+
name|RegionSpecifierType
operator|.
name|ENCODED_REGION_NAME
operator|+
literal|" actual: "
operator|+
name|type
argument_list|)
expr_stmt|;
block|}
try|try
block|{
name|master
operator|.
name|checkInitialized
argument_list|()
expr_stmt|;
name|master
operator|.
name|move
argument_list|(
name|encodedRegionName
argument_list|,
name|destServerName
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
return|return
name|mrr
return|;
block|}
comment|/**    * Offline specified region from master's in-memory state. It will not attempt to    * reassign the region as in unassign.    *    * This is a special method that should be used by experts or hbck.    *    */
annotation|@
name|Override
specifier|public
name|OfflineRegionResponse
name|offlineRegion
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|OfflineRegionRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
specifier|final
name|byte
index|[]
name|regionName
init|=
name|request
operator|.
name|getRegion
argument_list|()
operator|.
name|getValue
argument_list|()
operator|.
name|toByteArray
argument_list|()
decl_stmt|;
name|RegionSpecifierType
name|type
init|=
name|request
operator|.
name|getRegion
argument_list|()
operator|.
name|getType
argument_list|()
decl_stmt|;
if|if
condition|(
name|type
operator|!=
name|RegionSpecifierType
operator|.
name|REGION_NAME
condition|)
block|{
name|LOG
operator|.
name|warn
argument_list|(
literal|"moveRegion specifier type: expected: "
operator|+
name|RegionSpecifierType
operator|.
name|REGION_NAME
operator|+
literal|" actual: "
operator|+
name|type
argument_list|)
expr_stmt|;
block|}
try|try
block|{
name|master
operator|.
name|checkInitialized
argument_list|()
expr_stmt|;
name|Pair
argument_list|<
name|HRegionInfo
argument_list|,
name|ServerName
argument_list|>
name|pair
init|=
name|MetaTableAccessor
operator|.
name|getRegion
argument_list|(
name|master
operator|.
name|getConnection
argument_list|()
argument_list|,
name|regionName
argument_list|)
decl_stmt|;
if|if
condition|(
name|pair
operator|==
literal|null
condition|)
throw|throw
operator|new
name|UnknownRegionException
argument_list|(
name|Bytes
operator|.
name|toStringBinary
argument_list|(
name|regionName
argument_list|)
argument_list|)
throw|;
name|HRegionInfo
name|hri
init|=
name|pair
operator|.
name|getFirst
argument_list|()
decl_stmt|;
if|if
condition|(
name|master
operator|.
name|cpHost
operator|!=
literal|null
condition|)
block|{
name|master
operator|.
name|cpHost
operator|.
name|preRegionOffline
argument_list|(
name|hri
argument_list|)
expr_stmt|;
block|}
name|LOG
operator|.
name|info
argument_list|(
name|master
operator|.
name|getClientIdAuditPrefix
argument_list|()
operator|+
literal|" offline "
operator|+
name|hri
operator|.
name|getRegionNameAsString
argument_list|()
argument_list|)
expr_stmt|;
name|master
operator|.
name|assignmentManager
operator|.
name|regionOffline
argument_list|(
name|hri
argument_list|)
expr_stmt|;
if|if
condition|(
name|master
operator|.
name|cpHost
operator|!=
literal|null
condition|)
block|{
name|master
operator|.
name|cpHost
operator|.
name|postRegionOffline
argument_list|(
name|hri
argument_list|)
expr_stmt|;
block|}
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
return|return
name|OfflineRegionResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|build
argument_list|()
return|;
block|}
comment|/**    * Execute Restore/Clone snapshot operation.    *    *<p>If the specified table exists a "Restore" is executed, replacing the table    * schema and directory data with the content of the snapshot.    * The table must be disabled, or a UnsupportedOperationException will be thrown.    *    *<p>If the table doesn't exist a "Clone" is executed, a new table is created    * using the schema at the time of the snapshot, and the content of the snapshot.    *    *<p>The restore/clone operation does not require copying HFiles. Since HFiles    * are immutable the table can point to and use the same files as the original one.    */
annotation|@
name|Override
specifier|public
name|RestoreSnapshotResponse
name|restoreSnapshot
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|RestoreSnapshotRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|checkInitialized
argument_list|()
expr_stmt|;
name|master
operator|.
name|snapshotManager
operator|.
name|checkSnapshotSupport
argument_list|()
expr_stmt|;
comment|// ensure namespace exists
name|TableName
name|dstTable
init|=
name|TableName
operator|.
name|valueOf
argument_list|(
name|request
operator|.
name|getSnapshot
argument_list|()
operator|.
name|getTable
argument_list|()
argument_list|)
decl_stmt|;
name|master
operator|.
name|getNamespaceDescriptor
argument_list|(
name|dstTable
operator|.
name|getNamespaceAsString
argument_list|()
argument_list|)
expr_stmt|;
name|SnapshotDescription
name|reqSnapshot
init|=
name|request
operator|.
name|getSnapshot
argument_list|()
decl_stmt|;
name|master
operator|.
name|snapshotManager
operator|.
name|restoreSnapshot
argument_list|(
name|reqSnapshot
argument_list|)
expr_stmt|;
return|return
name|RestoreSnapshotResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|build
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|e
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
specifier|public
name|RunCatalogScanResponse
name|runCatalogScan
parameter_list|(
name|RpcController
name|c
parameter_list|,
name|RunCatalogScanRequest
name|req
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|checkInitialized
argument_list|()
expr_stmt|;
return|return
name|ResponseConverter
operator|.
name|buildRunCatalogScanResponse
argument_list|(
name|master
operator|.
name|catalogJanitorChore
operator|.
name|scan
argument_list|()
argument_list|)
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
specifier|public
name|SetBalancerRunningResponse
name|setBalancerRunning
parameter_list|(
name|RpcController
name|c
parameter_list|,
name|SetBalancerRunningRequest
name|req
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|checkInitialized
argument_list|()
expr_stmt|;
name|boolean
name|prevValue
init|=
operator|(
name|req
operator|.
name|getSynchronous
argument_list|()
operator|)
condition|?
name|synchronousBalanceSwitch
argument_list|(
name|req
operator|.
name|getOn
argument_list|()
argument_list|)
else|:
name|master
operator|.
name|balanceSwitch
argument_list|(
name|req
operator|.
name|getOn
argument_list|()
argument_list|)
decl_stmt|;
return|return
name|SetBalancerRunningResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|setPrevBalanceValue
argument_list|(
name|prevValue
argument_list|)
operator|.
name|build
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
specifier|public
name|ShutdownResponse
name|shutdown
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|ShutdownRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
name|LOG
operator|.
name|info
argument_list|(
name|master
operator|.
name|getClientIdAuditPrefix
argument_list|()
operator|+
literal|" shutdown"
argument_list|)
expr_stmt|;
name|master
operator|.
name|shutdown
argument_list|()
expr_stmt|;
return|return
name|ShutdownResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|build
argument_list|()
return|;
block|}
comment|/**    * Triggers an asynchronous attempt to take a snapshot.    * {@inheritDoc}    */
annotation|@
name|Override
specifier|public
name|SnapshotResponse
name|snapshot
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|SnapshotRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|checkInitialized
argument_list|()
expr_stmt|;
name|master
operator|.
name|snapshotManager
operator|.
name|checkSnapshotSupport
argument_list|()
expr_stmt|;
name|LOG
operator|.
name|info
argument_list|(
name|master
operator|.
name|getClientIdAuditPrefix
argument_list|()
operator|+
literal|" snapshot request for:"
operator|+
name|ClientSnapshotDescriptionUtils
operator|.
name|toString
argument_list|(
name|request
operator|.
name|getSnapshot
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
comment|// get the snapshot information
name|SnapshotDescription
name|snapshot
init|=
name|SnapshotDescriptionUtils
operator|.
name|validate
argument_list|(
name|request
operator|.
name|getSnapshot
argument_list|()
argument_list|,
name|master
operator|.
name|getConfiguration
argument_list|()
argument_list|)
decl_stmt|;
name|master
operator|.
name|snapshotManager
operator|.
name|takeSnapshot
argument_list|(
name|snapshot
argument_list|)
expr_stmt|;
comment|// send back the max amount of time the client should wait for the snapshot to complete
name|long
name|waitTime
init|=
name|SnapshotDescriptionUtils
operator|.
name|getMaxMasterTimeout
argument_list|(
name|master
operator|.
name|getConfiguration
argument_list|()
argument_list|,
name|snapshot
operator|.
name|getType
argument_list|()
argument_list|,
name|SnapshotDescriptionUtils
operator|.
name|DEFAULT_MAX_WAIT_TIME
argument_list|)
decl_stmt|;
return|return
name|SnapshotResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|setExpectedTimeout
argument_list|(
name|waitTime
argument_list|)
operator|.
name|build
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|e
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
specifier|public
name|StopMasterResponse
name|stopMaster
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|StopMasterRequest
name|request
parameter_list|)
throws|throws
name|ServiceException
block|{
name|LOG
operator|.
name|info
argument_list|(
name|master
operator|.
name|getClientIdAuditPrefix
argument_list|()
operator|+
literal|" stop"
argument_list|)
expr_stmt|;
name|master
operator|.
name|stopMaster
argument_list|()
expr_stmt|;
return|return
name|StopMasterResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|build
argument_list|()
return|;
block|}
annotation|@
name|Override
specifier|public
name|UnassignRegionResponse
name|unassignRegion
parameter_list|(
name|RpcController
name|controller
parameter_list|,
name|UnassignRegionRequest
name|req
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
specifier|final
name|byte
index|[]
name|regionName
init|=
name|req
operator|.
name|getRegion
argument_list|()
operator|.
name|getValue
argument_list|()
operator|.
name|toByteArray
argument_list|()
decl_stmt|;
name|RegionSpecifierType
name|type
init|=
name|req
operator|.
name|getRegion
argument_list|()
operator|.
name|getType
argument_list|()
decl_stmt|;
specifier|final
name|boolean
name|force
init|=
name|req
operator|.
name|getForce
argument_list|()
decl_stmt|;
name|UnassignRegionResponse
name|urr
init|=
name|UnassignRegionResponse
operator|.
name|newBuilder
argument_list|()
operator|.
name|build
argument_list|()
decl_stmt|;
name|master
operator|.
name|checkInitialized
argument_list|()
expr_stmt|;
if|if
condition|(
name|type
operator|!=
name|RegionSpecifierType
operator|.
name|REGION_NAME
condition|)
block|{
name|LOG
operator|.
name|warn
argument_list|(
literal|"unassignRegion specifier type: expected: "
operator|+
name|RegionSpecifierType
operator|.
name|REGION_NAME
operator|+
literal|" actual: "
operator|+
name|type
argument_list|)
expr_stmt|;
block|}
name|Pair
argument_list|<
name|HRegionInfo
argument_list|,
name|ServerName
argument_list|>
name|pair
init|=
name|MetaTableAccessor
operator|.
name|getRegion
argument_list|(
name|master
operator|.
name|getConnection
argument_list|()
argument_list|,
name|regionName
argument_list|)
decl_stmt|;
if|if
condition|(
name|pair
operator|==
literal|null
condition|)
throw|throw
operator|new
name|UnknownRegionException
argument_list|(
name|Bytes
operator|.
name|toString
argument_list|(
name|regionName
argument_list|)
argument_list|)
throw|;
name|HRegionInfo
name|hri
init|=
name|pair
operator|.
name|getFirst
argument_list|()
decl_stmt|;
if|if
condition|(
name|master
operator|.
name|cpHost
operator|!=
literal|null
condition|)
block|{
if|if
condition|(
name|master
operator|.
name|cpHost
operator|.
name|preUnassign
argument_list|(
name|hri
argument_list|,
name|force
argument_list|)
condition|)
block|{
return|return
name|urr
return|;
block|}
block|}
name|LOG
operator|.
name|debug
argument_list|(
name|master
operator|.
name|getClientIdAuditPrefix
argument_list|()
operator|+
literal|" unassign "
operator|+
name|hri
operator|.
name|getRegionNameAsString
argument_list|()
operator|+
literal|" in current location if it is online and reassign.force="
operator|+
name|force
argument_list|)
expr_stmt|;
name|master
operator|.
name|assignmentManager
operator|.
name|unassign
argument_list|(
name|hri
argument_list|)
expr_stmt|;
if|if
condition|(
name|master
operator|.
name|cpHost
operator|!=
literal|null
condition|)
block|{
name|master
operator|.
name|cpHost
operator|.
name|postUnassign
argument_list|(
name|hri
argument_list|,
name|force
argument_list|)
expr_stmt|;
block|}
return|return
name|urr
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
specifier|public
name|ReportRegionStateTransitionResponse
name|reportRegionStateTransition
parameter_list|(
name|RpcController
name|c
parameter_list|,
name|ReportRegionStateTransitionRequest
name|req
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|checkServiceStarted
argument_list|()
expr_stmt|;
name|RegionStateTransition
name|rt
init|=
name|req
operator|.
name|getTransition
argument_list|(
literal|0
argument_list|)
decl_stmt|;
name|TableName
name|tableName
init|=
name|ProtobufUtil
operator|.
name|toTableName
argument_list|(
name|rt
operator|.
name|getRegionInfo
argument_list|(
literal|0
argument_list|)
operator|.
name|getTableName
argument_list|()
argument_list|)
decl_stmt|;
name|RegionStates
name|regionStates
init|=
name|master
operator|.
name|assignmentManager
operator|.
name|getRegionStates
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
operator|(
name|TableName
operator|.
name|META_TABLE_NAME
operator|.
name|equals
argument_list|(
name|tableName
argument_list|)
operator|&&
name|regionStates
operator|.
name|getRegionState
argument_list|(
name|HRegionInfo
operator|.
name|FIRST_META_REGIONINFO
argument_list|)
operator|!=
literal|null
operator|)
operator|&&
operator|!
name|master
operator|.
name|assignmentManager
operator|.
name|isFailoverCleanupDone
argument_list|()
condition|)
block|{
comment|// Meta region is assigned before master finishes the
comment|// failover cleanup. So no need this check for it
throw|throw
operator|new
name|PleaseHoldException
argument_list|(
literal|"Master is rebuilding user regions"
argument_list|)
throw|;
block|}
name|ServerName
name|sn
init|=
name|ProtobufUtil
operator|.
name|toServerName
argument_list|(
name|req
operator|.
name|getServer
argument_list|()
argument_list|)
decl_stmt|;
name|String
name|error
init|=
name|master
operator|.
name|assignmentManager
operator|.
name|onRegionTransition
argument_list|(
name|sn
argument_list|,
name|rt
argument_list|)
decl_stmt|;
name|ReportRegionStateTransitionResponse
operator|.
name|Builder
name|rrtr
init|=
name|ReportRegionStateTransitionResponse
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
if|if
condition|(
name|error
operator|!=
literal|null
condition|)
block|{
name|rrtr
operator|.
name|setErrorMessage
argument_list|(
name|error
argument_list|)
expr_stmt|;
block|}
return|return
name|rrtr
operator|.
name|build
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|ioe
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
specifier|public
name|SetQuotaResponse
name|setQuota
parameter_list|(
name|RpcController
name|c
parameter_list|,
name|SetQuotaRequest
name|req
parameter_list|)
throws|throws
name|ServiceException
block|{
try|try
block|{
name|master
operator|.
name|checkInitialized
argument_list|()
expr_stmt|;
return|return
name|master
operator|.
name|getMasterQuotaManager
argument_list|()
operator|.
name|setQuota
argument_list|(
name|req
argument_list|)
return|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|ServiceException
argument_list|(
name|e
argument_list|)
throw|;
block|}
block|}
block|}
end_class

end_unit

