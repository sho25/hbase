begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_package
package|package
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|shell
operator|.
name|formatter
package|;
end_package

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|OutputStreamWriter
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|Writer
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hbase
operator|.
name|shell
operator|.
name|TableFormatter
import|;
end_import

begin_import
import|import
name|org
operator|.
name|znerd
operator|.
name|xmlenc
operator|.
name|LineBreak
import|;
end_import

begin_import
import|import
name|org
operator|.
name|znerd
operator|.
name|xmlenc
operator|.
name|XMLOutputter
import|;
end_import

begin_comment
comment|/**  * Formatter that outputs data inside an HTML table. If only a single cell  * result, then no formatting is done.  Presumption is that client manages  * serial access outputting tables.  Does not close passed {@link Writer}.  * Since hbase columns have no typing, the formatter presumes a type of  * UTF-8 String.  If cells contain images, etc., this formatter will mangle  * their display.  *<p>TODO: Uses xmlenc. Hopefully it flushes every so often (Claims its a   * stream-based outputter).  Verify.  */
end_comment

begin_class
specifier|public
class|class
name|HtmlTableFormatter
implements|implements
name|TableFormatter
block|{
specifier|private
specifier|final
name|XMLOutputter
name|outputter
decl_stmt|;
specifier|private
name|boolean
name|noFormatting
init|=
literal|false
decl_stmt|;
specifier|private
specifier|final
name|Writer
name|out
decl_stmt|;
comment|// Uninstantiable
annotation|@
name|SuppressWarnings
argument_list|(
literal|"unused"
argument_list|)
specifier|private
name|HtmlTableFormatter
parameter_list|()
block|{
name|this
argument_list|(
literal|null
argument_list|)
expr_stmt|;
block|}
specifier|public
name|HtmlTableFormatter
parameter_list|(
specifier|final
name|Writer
name|o
parameter_list|)
block|{
name|this
operator|.
name|out
operator|=
name|o
expr_stmt|;
try|try
block|{
comment|// Looking at the xmlenc source, there should be no issue w/ wrapping
comment|// the stream -- i.e. no hanging resources.
name|this
operator|.
name|outputter
operator|=
operator|new
name|XMLOutputter
argument_list|(
name|this
operator|.
name|out
argument_list|,
literal|"UTF-8"
argument_list|)
expr_stmt|;
name|String
name|os
init|=
name|System
operator|.
name|getProperty
argument_list|(
literal|"os.name"
argument_list|)
operator|.
name|toLowerCase
argument_list|()
decl_stmt|;
comment|// Shell likes the DOS output.
name|this
operator|.
name|outputter
operator|.
name|setLineBreak
argument_list|(
name|os
operator|.
name|contains
argument_list|(
literal|"windows"
argument_list|)
condition|?
name|LineBreak
operator|.
name|DOS
else|:
name|LineBreak
operator|.
name|UNIX
argument_list|)
expr_stmt|;
name|this
operator|.
name|outputter
operator|.
name|setIndentation
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|RuntimeException
argument_list|(
name|e
argument_list|)
throw|;
block|}
block|}
comment|/**    * @param titles List of titles.  Pass null if no formatting (i.e.    * no header, no footer, etc.    * @throws IOException     */
specifier|public
name|void
name|header
parameter_list|(
name|String
index|[]
name|titles
parameter_list|)
throws|throws
name|IOException
block|{
if|if
condition|(
name|titles
operator|==
literal|null
condition|)
block|{
comment|// print nothing.
name|setNoFormatting
argument_list|(
literal|true
argument_list|)
expr_stmt|;
return|return;
block|}
comment|// Can't add a 'border=1' attribute because its included on the end in
name|this
operator|.
name|outputter
operator|.
name|startTag
argument_list|(
literal|"table"
argument_list|)
expr_stmt|;
name|this
operator|.
name|outputter
operator|.
name|startTag
argument_list|(
literal|"tr"
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|titles
operator|.
name|length
condition|;
name|i
operator|++
control|)
block|{
name|this
operator|.
name|outputter
operator|.
name|startTag
argument_list|(
literal|"th"
argument_list|)
expr_stmt|;
name|this
operator|.
name|outputter
operator|.
name|pcdata
argument_list|(
name|titles
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|this
operator|.
name|outputter
operator|.
name|endTag
argument_list|()
expr_stmt|;
block|}
name|this
operator|.
name|outputter
operator|.
name|endTag
argument_list|()
expr_stmt|;
block|}
specifier|public
name|void
name|row
parameter_list|(
name|String
index|[]
name|cells
parameter_list|)
throws|throws
name|IOException
block|{
if|if
condition|(
name|isNoFormatting
argument_list|()
condition|)
block|{
name|getOut
argument_list|()
operator|.
name|write
argument_list|(
name|cells
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
return|return;
block|}
name|this
operator|.
name|outputter
operator|.
name|startTag
argument_list|(
literal|"tr"
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|cells
operator|.
name|length
condition|;
name|i
operator|++
control|)
block|{
name|this
operator|.
name|outputter
operator|.
name|startTag
argument_list|(
literal|"td"
argument_list|)
expr_stmt|;
name|this
operator|.
name|outputter
operator|.
name|pcdata
argument_list|(
name|cells
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|this
operator|.
name|outputter
operator|.
name|endTag
argument_list|()
expr_stmt|;
block|}
name|this
operator|.
name|outputter
operator|.
name|endTag
argument_list|()
expr_stmt|;
block|}
specifier|public
name|void
name|footer
parameter_list|()
throws|throws
name|IOException
block|{
if|if
condition|(
operator|!
name|isNoFormatting
argument_list|()
condition|)
block|{
comment|// To close the table
name|this
operator|.
name|outputter
operator|.
name|endTag
argument_list|()
expr_stmt|;
name|this
operator|.
name|outputter
operator|.
name|endDocument
argument_list|()
expr_stmt|;
block|}
comment|// We're done. Clear flag.
name|this
operator|.
name|setNoFormatting
argument_list|(
literal|false
argument_list|)
expr_stmt|;
comment|// If no formatting, output a newline to delimit cell and the
comment|// result summary output at end of every command.  If html, also emit a
comment|// newline to delimit html and summary line.
name|getOut
argument_list|()
operator|.
name|write
argument_list|(
name|System
operator|.
name|getProperty
argument_list|(
literal|"line.separator"
argument_list|)
argument_list|)
expr_stmt|;
name|getOut
argument_list|()
operator|.
name|flush
argument_list|()
expr_stmt|;
block|}
specifier|public
name|Writer
name|getOut
parameter_list|()
block|{
return|return
name|this
operator|.
name|out
return|;
block|}
specifier|public
name|boolean
name|isNoFormatting
parameter_list|()
block|{
return|return
name|this
operator|.
name|noFormatting
return|;
block|}
specifier|public
name|void
name|setNoFormatting
parameter_list|(
name|boolean
name|noFormatting
parameter_list|)
block|{
name|this
operator|.
name|noFormatting
operator|=
name|noFormatting
expr_stmt|;
block|}
specifier|public
specifier|static
name|void
name|main
parameter_list|(
name|String
index|[]
name|args
parameter_list|)
throws|throws
name|IOException
block|{
name|HtmlTableFormatter
name|f
init|=
operator|new
name|HtmlTableFormatter
argument_list|(
operator|new
name|OutputStreamWriter
argument_list|(
name|System
operator|.
name|out
argument_list|,
literal|"UTF-8"
argument_list|)
argument_list|)
decl_stmt|;
name|f
operator|.
name|header
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"a"
block|,
literal|"b"
block|}
argument_list|)
expr_stmt|;
name|f
operator|.
name|row
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"a"
block|,
literal|"b"
block|}
argument_list|)
expr_stmt|;
name|f
operator|.
name|footer
argument_list|()
expr_stmt|;
block|}
block|}
end_class

end_unit

