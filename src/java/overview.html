<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>

<!--
   Licensed to the Apache Software Foundation (ASF) under one or more
   contributor license agreements.  See the NOTICE file distributed with
   this work for additional information regarding copyright ownership.
   The ASF licenses this file to You under the Apache License, Version 2.0
   (the "License"); you may not use this file except in compliance with
   the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
-->

<head>
    <title>HBase</title>
</head>
<body bgcolor="white">
<a href="http://hbase.org">HBase</a> is a scalable, distributed database built on <a href="http://hadoop.apache.org/core">Hadoop Core</a>.

<h2><a name="requirements">Requirements</a></h2>
<ul>
  <li>Java 1.6.x, preferably from <a href="http://www.java.com/en/download/">Sun</a>.
  Use the latest version available.
  </li>
  <li>This version of HBase will only run on <a href="http://hadoop.apache.org/core/releases.html">Hadoop 0.20.x</a>.  
  </li>
  <li>
    ssh must be installed and sshd must be running to use Hadoop's
    scripts to manage remote Hadoop daemons.
  </li>
      <li>HBase depends on <a href="http://hadoop.apache.org/zookeeper/">ZooKeeper</a> as of release 0.20.0.
      Clients and Servers now must know where their ZooKeeper Quorum locations before
      they can do anything else.
      In basic standalone and pseudo-distributed modes, HBase manages a ZooKeeper instance
      for you but it is required that you run a ZooKeeper Quorum when running HBase
      fully distributed (More on this below). The Zookeeper addition changes
      how some core HBase configuration is done.
      </li>
  <li>Hosts must be able to resolve the fully-qualified domain name of the master.</li>
  <li>HBase currently is a file handle hog.  The usual default of
  1024 on *nix systems is insufficient if you are loading any significant
  amount of data into regionservers.  See the
  <a href="http://wiki.apache.org/hadoop/Hbase/FAQ#6">FAQ: Why do I see "java.io.IOException...(Too many open files)" in my logs?</a>
  for how to up the limit.  Also, as of 0.18.x hadoop, datanodes have an upper-bound
      on the number of threads they will support (<code>dfs.datanode.max.xcievers</code>).
      Default is 256.  Up this limit on your hadoop cluster.
      <li>The clocks on cluster members should be in basic alignments.  Some skew is tolerable but
      wild skew can generate odd behaviors.  Run <a href="http://en.wikipedia.org/wiki/Network_Time_Protocol">NTP</a>
      on your cluster, or an equivalent.</li>
      <li>HBase servers put up 10 listeners for incoming connections by default.  Up this
      number if you have a dataset of any substance by setting hbase.regionserver.handler.count
      in your hbase-site.xml.</li>
      <li>This is a list of patches we recommend you apply to your running Hadoop cluster:
      <ul>
      <li><a hef="https://issues.apache.org/jira/browse/HADOOP-4681">HADOOP-4681 <i>"DFSClient block read failures cause open DFSInputStream to become unusable"</i></a>. This patch will help with the ever-popular, "No live nodes contain current block".
      The hadoop version bundled with hbase has this patch applied.  Its an HDFS client
      fix so this should do for usual usage but if your cluster is missing the patch,
      and in particular if calling hbase from a mapreduce job, you may run into this
      issue.
      </li>
      </ul>
      </li>
</ul>
<h3>Windows</h3>
If you are running HBase on Windows, you must install <a href="http://cygwin.com/">Cygwin</a>.
Additionally, it is <emph>strongly recommended</emph> that you add or append to the following
environment variables. If you install Cygwin in a location that is not <code>C:\cygwin</code> you
should modify the following appropriately.
<p>
<blockquote>
<pre>
HOME=c:\cygwin\home\jim
ANT_HOME=(wherever you installed ant)
JAVA_HOME=(wherever you installed java) 
PATH=C:\cygwin\bin;%JAVA_HOME%\bin;%ANT_HOME%\bin; other windows stuff 
SHELL=/bin/bash
</pre>
</blockquote>
For additional information, see the
<a href="http://hadoop.apache.org/core/docs/current/quickstart.html">Hadoop Quick Start Guide</a>
</p>
<h2><a name="getting_started" >Getting Started</a></h2>
<p>
What follows presumes you have obtained a copy of HBase,
see <a href="http://hadoop.apache.org/hbase/releases.html">Releases</a>, and are installing
for the first time. If upgrading your
HBase instance, see <a href="#upgrading">Upgrading</a>.
</p>
<p>Three modes are described: standalone, pseudo-distributed (where all servers are run on
a single host), and distributed.  If new to hbase start by following the standalone instruction.
</p>
<p>
Whatever your mode, define <code>${HBASE_HOME}</code> to be the location of the root of your HBase installation, e.g. 
<code>/user/local/hbase</code>.  Edit <code>${HBASE_HOME}/conf/hbase-env.sh</code>.  In this file you can
set the heapsize for HBase, etc.  At a minimum, set <code>JAVA_HOME</code> to point at the root of
your Java installation.
</p>
<h2><a name="standalone">Standalone Mode</a></h2>
<p>
If you are running a standalone operation, there should be nothing further to configure; proceed to
<a href=#runandconfirm>Running and Confirming Your Installation</a>.  If you are running a distributed 
operation, continue reading.
</p>

<h2><a name="distributed">Distributed Operation: Pseudo- and Fully-Distributed Modes</a></h2>
<p>Distributed mode requires an instance of the Hadoop Distributed File System (DFS).
See the Hadoop <a href="http://lucene.apache.org/hadoop/api/overview-summary.html#overview_description">
requirements and instructions</a> for how to set up a DFS.
</p>

<h3><a name="pseudo-distrib">Pseudo-Distributed Operation</a></h3>
<p>A pseudo-distributed operation is simply a distributed operation run on a single host.  
Once you have confirmed your DFS setup, configuring HBase for use on one host requires modification of 
<code>${HBASE_HOME}/conf/hbase-site.xml</code>, which needs to be pointed at the running Hadoop DFS instance.  
Use <code>hbase-site.xml</code> to override the properties defined in 
<code>${HBASE_HOME}/conf/hbase-default.xml</code> (<code>hbase-default.xml</code> itself 
should never be modified).  At a minimum the <code>hbase.rootdir</code> property should be redefined 
in <code>hbase-site.xml</code> to point HBase at the Hadoop filesystem to use.  For example, adding the property 
below to your <code>hbase-site.xml</code> says that HBase should use the <code>/hbase</code> directory in the 
HDFS whose namenode is at port 9000 on your local machine:
</p>
<pre>
&lt;configuration&gt;
  ...
  &lt;property&gt;
    &lt;name&gt;hbase.rootdir&lt;/name&gt;
    &lt;value&gt;hdfs://localhost:9000/hbase&lt;/value&gt;
    &lt;description&gt;The directory shared by region servers.
    &lt;/description&gt;
  &lt;/property&gt;
  ...
&lt;/configuration&gt;
</pre>
<p>Note: Let hbase create the directory.  If you don't, you'll get warning saying hbase
needs a migration run because the directory is missing files expected by hbase (it'll
create them if you let it).
</p>

<h3><a name="fully-distrib">Fully-Distributed Operation</a></h3>
<p>For running a fully-distributed operation on more than one host, the following
configurations must be made <i>in addition</i> to those described in the
<a href="#pseudo-distrib">pseudo-distributed operation</a> section above.
In this mode, a ZooKeeper cluster is required.</p>  
<p>In <code>hbase-site.xml</code>, set <code>hbase.cluster.distributed</code> to 'true'. 
<blockquote>
<pre>
&lt;configuration&gt;
  ...
  &lt;property&gt;
    &lt;name&gt;hbase.cluster.distributed&lt;/name&gt;
    &lt;value&gt;true&lt;/value&gt;
    &lt;description&gt;The mode the cluster will be in. Possible values are
      false: standalone and pseudo-distributed setups with managed Zookeeper
      true: fully-distributed with unmanaged Zookeeper Quorum (see hbase-env.sh)
    &lt;/description&gt;
  &lt;/property&gt;
  ...
&lt;/configuration&gt;
</pre>
</blockquote>
</p>
<p>
In fully-distributed operation, you probably want to change your <code>hbase.rootdir</code> 
from localhost to the name of the node running the HDFS namenode.  In addition
to <code>hbase-site.xml</code> changes, a fully-distributed operation requires that you 
modify <code>${HBASE_HOME}/conf/regionservers</code>.  
The <code>regionserver</code> file lists all hosts running HRegionServers, one host per line
(This file in HBase is like the hadoop slaves file at <code>${HADOOP_HOME}/conf/slaves</code>).
</p>
<p>
A distributed HBase depends on a running ZooKeeper cluster.
HBase can manage a ZooKeeper cluster for you, or you can manage it on your own
and point HBase to it.
To toggle this option, use the <code>HBASE_MANAGES_ZK</code> variable in <code>
${HBASE_HOME}/conf/hbase-env.sh</code>.
This variable, which defaults to <code>true</code>, tells HBase whether to
start/stop the ZooKeeper quorum servers alongside the rest of the servers.
</p>
<p>
To point HBase at an existing ZooKeeper cluster, add your <code>zoo.cfg</code>
to the <code>CLASSPATH</code>.
HBase will see this file and use it to figure out where ZooKeeper is.
Additionally set <code>HBASE_MANAGES_ZK</code> in <code> ${HBASE_HOME}/conf/hbase-env.sh</code>
 to <code>false</code> so that HBase doesn't mess with your ZooKeeper setup:
<pre>
   ...
  # Tell HBase whether it should manage it's own instance of Zookeeper or not.
  export HBASE_MANAGES_ZK=false
</pre>
For more information about setting up a ZooKeeper cluster on your own, see
the ZooKeeper <a href="http://hadoop.apache.org/zookeeper/docs/current/zookeeperStarted.html">Getting Started Guide</a>.
HBase currently uses ZooKeeper version 3.2.0, so any cluster setup with a 3.x.x
version of ZooKeeper should work.
</p>
<p>
To have HBase manage the ZooKeeper cluster, you can use a <code>zoo.cfg</code>
 file as above, or edit the options directly in the <code>${HBASE_HOME}/conf/hbase-site.xml</code>.
Every option from the <code>zoo.cfg</code> has a corresponding property in the
XML configuration file named <code>hbase.zookeeper.property.OPTION</code>.
For example, the <code>clientPort</code> setting in ZooKeeper can be changed by
setting the <code>hbase.zookeeper.property.clientPort</code> property.
For the full list of available properties, see ZooKeeper's <code>zoo.cfg</code>.
For the default values used by HBase, see <code>${HBASE_HOME}/conf/hbase-default.xml</code>.
</p>
<p>
At minimum, you should set the list of servers that you want ZooKeeper to run
on using the <code>hbase.zookeeper.quorum</code> property.
This property defaults to <code>localhost</code> which is not suitable for a 
fully distributed HBase.
It is recommended to run a ZooKeeper quorum of 5 or 7 machines, and give each
server around 1GB to ensure that they don't swap.
It is also recommended to run the ZooKeeper servers on separate machines from
the Region Servers with their own disks.
If this is not easily doable for you, choose 5 of your region servers to run the
ZooKeeper servers on.
</p>
<p>
As an example, to have HBase manage a ZooKeeper quorum on nodes
rs{1,2,3,4,5}.example.com, bound to port 2222 (the default is 2181), use:
<pre>
  ${HBASE_HOME}/conf/hbase-env.sh:

       ...
      # Tell HBase whether it should manage it's own instance of Zookeeper or not.
      export HBASE_MANAGES_ZK=true

  ${HBASE_HOME}/conf/hbase-site.xml:

  &lt;configuration&gt;
    ...
    &lt;property&gt;
      &lt;name&gt;hbase.zookeeper.property.clientPort&lt;/name&gt;
      &lt;value&gt;2222&lt;/value&gt;
      &lt;description&gt;Property from ZooKeeper's config zoo.cfg.
      The port at which the clients will connect.
      &lt;/description&gt;
    &lt;/property&gt;
    ...
    &lt;property&gt;
      &lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt;
      &lt;value&gt;rs1.example.com,rs2.example.com,rs3.example.com,rs4.example.com,rs5.example.com&lt;/value&gt;
      &lt;description&gt;Comma separated list of servers in the ZooKeeper Quorum.
      For example, "host1.mydomain.com,host2.mydomain.com,host3.mydomain.com".
      By default this is set to localhost for local and pseudo-distributed modes
      of operation. For a fully-distributed setup, this should be set to a full
      list of ZooKeeper quorum servers. If HBASE_MANAGES_ZK is set in hbase-env.sh
      this is the list of servers which we will start/stop ZooKeeper on.
      &lt;/description&gt;
    &lt;/property&gt;
    ...
  &lt;/configuration&gt;
</pre>
</p>
<p>
When HBase manages ZooKeeper, it will start/stop the ZooKeeper servers as a part
of the regular start/stop scripts. If you would like to run it yourself, you can
do:
<pre>
  ${HBASE_HOME}/bin/hbase-daemons.sh {start,stop} zookeeper
</pre>
Note that you can use HBase in this manner to spin up a ZooKeeper cluster,
unrelated to HBase. Just make sure to set <code>HBASE_MANAGES_ZK</code> to
<code>false</code> if you want it to stay up so that when HBase shuts down it
doesn't take ZooKeeper with it.
</p>

<p>Of note, if you have made <i>HDFS client configuration</i> on your hadoop cluster, HBase will not
see this configuration unless you do one of the following:
<ul>
    <li>Add a pointer to your <code>HADOOP_CONF_DIR</code> to <code>CLASSPATH</code> in <code>hbase-env.sh</code></li>
    <li>Add a copy of <code>hadoop-site.xml</code> to <code>${HBASE_HOME}/conf</code>, or</li>
    <li>If only a small set of HDFS client configurations, add them to <code>hbase-site.xml</code></li>
</ul>
An example of such an HDFS client configuration is <code>dfs.replication</code>.  If for example,
you want to run with a replication factor of 5, hbase will create files with the default of 3 unless 
you do the above to make the configuration available to HBase.
</p>

<h2><a name="runandconfirm">Running and Confirming Your Installation</a></h2>
<p>If you are running in standalone, non-distributed mode, HBase by default uses
the local filesystem.</p>

<p>If you are running a distributed cluster you will need to start the Hadoop DFS daemons and
ZooKeeper Quorum
before starting HBase and stop the daemons after HBase has shut down.</p>
<p>Start and 
stop the Hadoop DFS daemons by running <code>${HADOOP_HOME}/bin/start-dfs.sh</code>.
You can ensure it started properly by testing the put and get of files into the Hadoop filesystem.
HBase does not normally use the mapreduce daemons.  These do not need to be started.</p>

<p>Start up your ZooKeeper cluster.</p>

<p>Start HBase with the following command:
</p>
<pre>
${HBASE_HOME}/bin/start-hbase.sh
</pre>
<p>
Once HBase has started, enter <code>${HBASE_HOME}/bin/hbase shell</code> to obtain a 
shell against HBase from which you can execute commands.  
Test your installation by creating, viewing, and dropping 
To stop HBase, exit the HBase shell and enter:
</p>
<pre>
${HBASE_HOME}/bin/stop-hbase.sh
</pre>
<p>
If you are running a distributed operation, be sure to wait until HBase has shut down completely 
before stopping the Hadoop daemons.
</p>
<p>
The default location for logs is <code>${HBASE_HOME}/logs</code>.
</p>
<p>HBase also puts up a UI listing vital attributes.  By default its deployed on the master host
at port 60010 (HBase regionservers listen on port 60020 by default and put up an informational
http server at 60030).</p>

<h2><a name="upgrading" >Upgrading</a></h2>
<p>After installing a new HBase on top of data written by a previous HBase version, before
starting your cluster, run the <code>${HBASE_DIR}/bin/hbase migrate</code> migration script.
It will make any adjustments to the filesystem data under <code>hbase.rootdir</code> necessary to run
the HBase version. It does not change your install unless you explicitly ask it to.
</p>

<h2><a name="client_example">Example API Usage</a></h2>
For sample Java code, see <a href="org/apache/hadoop/hbase/client/package-summary.html#client_example">org.apache.hadoop.hbase.client</a> documentation.

<p>If your client is NOT Java, consider the Thrift or REST libraries.</p>

<h2><a name="related" >Related Documentation</a></h2>
<ul>
  <li><a href="http://hbase.org">HBase Home Page</a>
  <li><a href="http://wiki.apache.org/hadoop/Hbase">HBase Wiki</a>
  <li><a href="http://hadoop.apache.org/">Hadoop Home Page</a>
</ul>

</body>
</html>
